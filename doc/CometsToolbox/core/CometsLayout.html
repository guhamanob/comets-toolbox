<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of CometsLayout</title>
  <meta name="keywords" content="CometsLayout">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # CometsToolbox --><!-- menu.html core -->
<h1>CometsLayout
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="CometsLayout.html" class="code" title="">CometsLayout</a>	</li><li><a href="CometsParams.html" class="code" title="">CometsParams</a>	</li><li><a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>	STRIDX(str, {str}, [true]) Get the indexes of the query string in the given cell array.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="CometsLayout.html" class="code" title="">CometsLayout</a>	</li><li><a href="../../CometsToolbox/factory/createLayout.html" class="code" title="function layout = createLayout(varargin)">createLayout</a>	CREATELAYOUT intialize a new blank Layout or one using the given models</li><li><a href="../../CometsToolbox/projects/ga/createGALayout.html" class="code" title="function layout=createGALayout(genome)">createGALayout</a>	Uday Tripathi 7/2016</li><li><a href="../../CometsToolbox/sample/old/demo62.html" class="code" title="">demo62</a>	Import from SBML</li><li><a href="../../CometsToolbox/scratch/scratchpad.html" class="code" title="">scratchpad</a>	A script to hold experiments while designing COMETS utility functions</li><li><a href="../../CometsToolbox/scratch/write_run.html" class="code" title="">write_run</a>	test writing the files for a COMETS run, then execute COMETS from the</li><li><a href="../../CometsToolbox/test/testSetInitialPop.html" class="code" title="">testSetInitialPop</a>	TESTSETINITIALPOP Confirm that the setInitialPop function works as</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = CometsLayout()</a></li><li><a href="#_sub2" class="code">function self = addModel(self,model)</a></li><li><a href="#_sub3" class="code">function self = addMets(self,newnames)</a></li><li><a href="#_sub4" class="code">function self = setParams(self,params)</a></li><li><a href="#_sub5" class="code">function idx=metIdx(self,name)</a></li><li><a href="#_sub6" class="code">function self = setXdim(self,x)</a></li><li><a href="#_sub7" class="code">function self = setYdim(self,y)</a></li><li><a href="#_sub8" class="code">function self = setDims(self,x,y)</a></li><li><a href="#_sub9" class="code">function self = setInitialMediaInCell(self,x,y,metname,value)</a></li><li><a href="#_sub10" class="code">function self = setInitialMedia(self,metname,value)</a></li><li><a href="#_sub11" class="code">function self = setMedia(self, metname, value)</a></li><li><a href="#_sub12" class="code">function self = sortMetabolites(self)</a></li><li><a href="#_sub13" class="code">function self = setDiffusion(varargin)</a></li><li><a href="#_sub14" class="code">function self = setStaticMedia(varargin)</a></li><li><a href="#_sub15" class="code">function self = applyStaticMediaMask(self, mask, metnames, values)</a></li><li><a href="#_sub16" class="code">function self = setMediaRefresh(self, x, y, mets, values)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="CometsLayout.html" class="code" title="">CometsLayout</a>
0002 <span class="comment">%CometsLayout Defines the COMETS world and contains COBRA models.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%     Constructor: CometsLayout()</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%     Standard workflow should be as follows: 1) Create an empty layout</span>
0007 <span class="comment">%         world = CometsLayout()</span>
0008 <span class="comment">%     2) Set global and model-level defaults in the contained CometsParams</span>
0009 <span class="comment">%         world.params.DefaultVmax = 10</span>
0010 <span class="comment">%     3) Add COBRA models</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%     See also CometsParams</span>
0013 <span class="comment">%</span>
0014     properties
0015         models = {};
0016         xdim = 1;
0017         ydim = 1;
0018         mets = {}; <span class="comment">%cell array of strings</span>
0019         media_amt = [0];<span class="comment">%vector 1/met, default 0. Initial media concentration in every cell</span>
0020         params = <a href="CometsParams.html" class="code" title="">CometsParams</a>();
0021         <span class="comment">%use sparse matrices. Empty elements use default values</span>
0022         diffusion_constants = []; <span class="comment">%met by 2. If (i,1)=0, met i uses the default diffusion constant. if (i,1)=1, met i's diffusion constant is the value of (i,2). Units = cm^2/s</span>
0023         global_media_refresh = [];<span class="comment">%vector 1/met, default 0</span>
0024         media_refresh = [];<span class="comment">%[0] %met by x by y, fill with 0. Units = concentration</span>
0025         global_static_media = [];<span class="comment">%met by 2. (met,1) is logical denoting if the corresponding media is held static, (met,2) is the held concentration. Units = concentration</span>
0026         static_media = [0];<span class="comment">%met by x by y by 2, with the fourth dimension as in global_static_media ****</span>
0027         initial_media = [0]; <span class="comment">%met by x by y by 2. Initial media concentration in the specified cell. Fourth dimension denotes [isThisValueSet?, value]</span>
0028         <span class="comment">%To further explain these last four, if the fourth dimension holds (1,0) the value in the cell is not empty/default; it's set to zero.</span>
0029         barrier = [0]; <span class="comment">%x by y, logical</span>
0030         initial_pop = [0];<span class="comment">%models by x by y, default 0. Units = grams.</span>
0031         external_rxns = table();
0032         external_rxn_mets = table();
0033         <span class="comment">%TODO: initial_pop modes (rectangle, random...)</span>
0034     <span class="keyword">end</span>
0035     
0036     methods
0037         <a name="_sub0" href="#_subfunctions" class="code">function obj = CometsLayout()</a>
0038         <span class="keyword">end</span>
0039         
0040         <a name="_sub1" href="#_subfunctions" class="code">function self = addModel(self,model)</a>
0041             self.models = [self.models model];
0042             
0043             <span class="comment">%if the model contains any external metabolites, add them to this mets list</span>
0044             <span class="comment">%get exchange reactions</span>
0045             excl = findExcRxns(model); <span class="comment">%logical: does this rxn have 1 metabolite?</span>
0046             exc = model.S(:,excl); <span class="comment">%S matrix slice of just exchange reactions</span>
0047             [row,col] = find(exc);
0048             names = model.mets(row);
0049             
0050             <span class="comment">%mis = sum(abs(exc)); %collapse to vector of exchange metabolites</span>
0051             <span class="comment">%names = model.mets(mis~=0); %get logical index of cells</span>
0052             
0053             newnames = setdiff(names, self.mets);
0054             self = <a href="#_sub3" class="code" title="subfunction self = addMets(self,newnames)">addMets</a>(self,newnames);
0055         <span class="keyword">end</span>
0056         
0057         <a name="_sub2" href="#_subfunctions" class="code">function self = addMets(self,newnames)</a>
0058             <span class="comment">%Add the metabolites in the cell array newnames to this layout</span>
0059             newnames = setdiff(newnames, self.mets);
0060             
0061             <span class="comment">%make sure the newnames array is vertical</span>
0062             [w,h] = size(newnames);
0063             <span class="keyword">if</span> h &gt; w
0064                 newnames = newnames';
0065             <span class="keyword">end</span>
0066             
0067             self.mets = [self.mets; newnames]; <span class="comment">%must maintain order, don't use Union</span>
0068             
0069             diff = length(self.mets) - length(self.media_amt);
0070             <span class="keyword">if</span> diff &gt; 0
0071                 self.media_amt = [self.media_amt; zeros(diff,1)];
0072             <span class="keyword">end</span>
0073             
0074             diff = length(self.mets) - length(self.diffusion_constants);
0075             <span class="keyword">if</span> diff &gt; 0
0076                 self.diffusion_constants = [self.diffusion_constants; zeros(diff,2)];
0077             <span class="keyword">end</span>
0078             
0079             diff = length(self.mets) - length(self.global_media_refresh);
0080             <span class="keyword">if</span> diff &gt; 0
0081                 self.global_media_refresh = [self.global_media_refresh; zeros(diff,1)];
0082             <span class="keyword">end</span>
0083             
0084             diff = length(self.mets) - size(self.media_refresh,1);
0085             <span class="keyword">if</span> diff &gt; 0
0086                 self.media_refresh(length(self.mets),:,:)=0;
0087             <span class="keyword">end</span>
0088             
0089             diff = length(self.mets) - size(self.global_static_media,1);
0090             <span class="keyword">if</span> diff &gt; 0
0091                 self.global_static_media = [self.global_static_media; zeros(diff,2)];
0092             <span class="keyword">end</span>
0093             
0094             diff = length(self.mets) - size(self.static_media,1);
0095             <span class="keyword">if</span> diff &gt; 0
0096                 <span class="comment">%self.static_media = [self.static_media; zeros(diff,self.xdim,self.ydim,2)];</span>
0097                 self.static_media(length(self.mets),:,:,:)=0;
0098             <span class="keyword">end</span>
0099         <span class="keyword">end</span>
0100         
0101         <span class="comment">%function self=removeModel(self,model)</span>
0102         <span class="comment">%end</span>
0103         
0104         <a name="_sub3" href="#_subfunctions" class="code">function self = setParams(self,params)</a>
0105             self.params = params;
0106         <span class="keyword">end</span>
0107         
0108         <a name="_sub4" href="#_subfunctions" class="code">function idx=metIdx(self,name)</a>
0109             idx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(name,self.mets,false);
0110         <span class="keyword">end</span>
0111         
0112         <a name="_sub5" href="#_subfunctions" class="code">function self = setXdim(self,x)</a>
0113             diff = x - self.xdim;
0114             <span class="keyword">if</span> diff &lt; 0
0115                 self.media_refresh = self.media_refresh(1:x,:); <span class="comment">%met by x by y, default 0</span>
0116                 self.static_media = self.static_media(:,1:x,:); <span class="comment">%met by x by y by 2, with the fourth dimension as in global_static_media</span>
0117                 self.barrier = self.barrier(1:x,:); <span class="comment">%x by y, logical</span>
0118                 self.initial_pop = self.initial_pop(:,1:x,:); <span class="comment">%models by x by y</span>
0119             <span class="keyword">elseif</span> diff &gt; 0
0120                 <span class="comment">%self.media_refresh = [self.media_refresh; zeros(diff,self.ydim)]; %met by x by y, default 0</span>
0121                 self.media_refresh(:,x,:) = 0;
0122                 <span class="comment">%self.static_media = [self.static_media; zeros(length(self.mets),diff,self.ydim,2)]; %met by x by y by 2, with the fourth dimension as in global_static_media</span>
0123                 self.static_media(:,x,:,:) = 0;
0124                 self.barrier = [self.barrier; zeros(diff,self.ydim)]; <span class="comment">%x by y, logical</span>
0125                 <span class="comment">%self.initial_pop = [self.initial_pop; nan(length(self.models),diff,self.ydim)]; %models by x by y</span>
0126                 self.initial_pop(:,x,:) = 0;
0127             <span class="keyword">end</span>
0128             self.xdim = x;
0129         <span class="keyword">end</span>
0130         
0131         <a name="_sub6" href="#_subfunctions" class="code">function self = setYdim(self,y)</a>
0132             diff = y - self.ydim;
0133             <span class="keyword">if</span> diff &lt; 0
0134                 self.media_refresh = self.media_refresh(:,1:y); <span class="comment">%met by x by y, default 0</span>
0135                 self.static_media = self.static_media(:,:,1:y); <span class="comment">%met by x by y by 2, with the fourth dimension as in global_static_media</span>
0136                 self.barrier = self.barrier(:,1:y); <span class="comment">%x by y, logical</span>
0137                 self.initial_pop = self.initial_pop(:,:,1:y); <span class="comment">%models by x by y</span>
0138             <span class="keyword">elseif</span> diff &gt; 0
0139                 <span class="comment">%self.media_refresh = [self.media_refresh; zeros(self.xdim,diff)]; %met by x by y, default 0</span>
0140                 self.media_refresh(:,:,y) = 0;
0141                 <span class="comment">%self.static_media = [self.static_media; zeros(length(self.mets),self.xdim,diff,2)]; %met by x by y by 2, with the fourth dimension as in global_static_media</span>
0142                 self.static_media(:,:,y,:) = 0;
0143                 self.barrier = [self.barrier zeros(self.xdim,diff)]; <span class="comment">%x by y, logical</span>
0144                 <span class="comment">%self.initial_pop = [self.initial_pop; nan(length(self.models),self.xdim,diff)]; %models by x by y</span>
0145                 self.initial_pop(:,:,y,:) = 0;
0146             <span class="keyword">end</span>
0147             self.ydim = y;
0148         <span class="keyword">end</span>
0149         
0150         <a name="_sub7" href="#_subfunctions" class="code">function self = setDims(self,x,y)</a>
0151             self = self.setXdim(x);
0152             self = self.setYdim(y);
0153         <span class="keyword">end</span>
0154         
0155         <a name="_sub8" href="#_subfunctions" class="code">function self = setInitialMediaInCell(self,x,y,metname,value)</a>
0156             idx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(metname,self.mets,false);
0157             <span class="keyword">if</span> isempty(idx) || ~idx
0158                 warning([<span class="string">'Could not find '</span> metname <span class="string">' in the media list. Adding it as a new media component.'</span>]);
0159                 self = <a href="#_sub3" class="code" title="subfunction self = addMets(self,newnames)">addMets</a>(self,{metname});
0160                 idx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(metname,self.mets,false);
0161             <span class="keyword">end</span>
0162             self.initial_media(idx,x,y,1)=1;
0163             self.initial_media(idx,x,y,2)=value;
0164         <span class="keyword">end</span>
0165         
0166         <a name="_sub9" href="#_subfunctions" class="code">function self = setInitialMedia(self,metname,value)</a>
0167             <span class="comment">%split up cell array values of metname</span>
0168             <span class="keyword">if</span> iscell(metname)
0169                 len = length(metname);
0170                 v = repmat(value,1,len); <span class="comment">%in case a single value was given</span>
0171                 <span class="keyword">for</span> i = 1:len
0172                     mn = metname{i};
0173                     self = <a href="#_sub10" class="code" title="subfunction self = setInitialMedia(self,metname,value)">setInitialMedia</a>(self,mn,v(i));
0174                 <span class="keyword">end</span>
0175             <span class="keyword">else</span> <span class="comment">%metname is char</span>
0176                 <span class="comment">%set the initial amount of the metabolite given by name</span>
0177                 idx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(metname, self.mets, false);
0178                 <span class="keyword">if</span> isempty(idx) || ~idx
0179                     warning([<span class="string">'Could not find '</span> metname <span class="string">' in the media list. Adding it as a new media component.'</span>]);
0180                     self = <a href="#_sub3" class="code" title="subfunction self = addMets(self,newnames)">addMets</a>(self,{metname});
0181                     idx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(metname,self.mets,false);
0182                 <span class="keyword">end</span>
0183                 self.media_amt(idx) = value;
0184             <span class="keyword">end</span>
0185         <span class="keyword">end</span>
0186         
0187         <a name="_sub10" href="#_subfunctions" class="code">function self = setMedia(self, metname, value)</a>
0188             <span class="comment">%renamed setInitialMedia for simplicity</span>
0189             self = <a href="#_sub10" class="code" title="subfunction self = setInitialMedia(self,metname,value)">setInitialMedia</a>(self, metname, value);
0190         <span class="keyword">end</span>
0191         
0192         
0193         <a name="_sub11" href="#_subfunctions" class="code">function self = sortMetabolites(self)</a>
0194             <span class="comment">%sort the list of metabolites alphabetically, and rearrange other</span>
0195             <span class="comment">%lists accordingly</span>
0196             <span class="comment">%</span>
0197             <span class="comment">%lists to rearrange: mets, media_amt, diffusion_constants, global_media_refresh</span>
0198             <span class="comment">%media_refresh, global_static_media, static_media, initial_media</span>
0199             nmets = length(self.mets);
0200             x = self.xdim;
0201             y = self.ydim;
0202             [self.mets, map] = sort(self.mets);
0203             <span class="keyword">if</span> any(self.media_amt)
0204                 self.media_amt = self.media_amt(map);
0205             <span class="keyword">end</span>
0206             <span class="keyword">if</span> any(self.diffusion_constants)
0207                 self.diffusion_constants = self.diffusion_constants(map,1:2);
0208             <span class="keyword">end</span>
0209             <span class="keyword">if</span> any(self.global_media_refresh)
0210                 self.global_media_refresh = self.global_media_refresh(map);
0211             <span class="keyword">end</span>
0212             <span class="keyword">if</span> any(self.media_refresh(:))
0213                 s = size(self.media_refresh);
0214                 <span class="keyword">if</span> s(1) &lt; nmets
0215                     self.media_refresh(nmets,x,y) = 0;
0216                 <span class="keyword">end</span>
0217                 self.media_refresh = self.media_refresh(map,:,:);
0218             <span class="keyword">end</span>
0219             <span class="keyword">if</span> any(self.global_static_media(:))
0220                 self.global_static_media = self.global_static_media(map,:);
0221             <span class="keyword">end</span>
0222             <span class="keyword">if</span> any(self.static_media(:))
0223                 s = size(self.static_media);
0224                 <span class="keyword">if</span> s(1) &lt; nmets
0225                     self.static_media(nmets,x,y,2) = 0;
0226                 <span class="keyword">end</span>
0227                 self.static_media = self.static_media(map,:,:,:);
0228             <span class="keyword">end</span>
0229             <span class="keyword">if</span> any(self.initial_media(:))
0230                 s = size(self.initial_media);
0231                 <span class="keyword">if</span> s(1) &lt; nmets
0232                     self.initial_media(nmets,x,y,2) = 0;
0233                 <span class="keyword">end</span>
0234                 self.initial_media = self.initial_media(map,:,:,:);
0235             <span class="keyword">end</span>
0236         <span class="keyword">end</span>
0237         
0238         <a name="_sub12" href="#_subfunctions" class="code">function self = setDiffusion(varargin)</a>
0239             <span class="comment">%setDiffusion(self, metnames, [values])</span>
0240             <span class="comment">%set diffusion constants for the given metabolite or list of</span>
0241             <span class="comment">%metabolites</span>
0242             <span class="comment">%'metnames' can be a single metabolite name, a cell array of</span>
0243             <span class="comment">%metabolite names, a single metabolite index, or an array of</span>
0244             <span class="comment">%metabolite indexes</span>
0245             <span class="comment">%'values' can be a single value, an array of values, false, or</span>
0246             <span class="comment">%not given. If false or not given, the metabolites will have their</span>
0247             <span class="comment">%&quot;set&quot; flag (the first dimension in diffusion_constants) turned</span>
0248             <span class="comment">%off. If a single value, all input metabolites will get that value</span>
0249             <span class="comment">%assigned. If an array, there must be one value per metabolite</span>
0250             self = varargin{1};
0251             
0252             midx = [];
0253             <span class="keyword">switch</span> class(varargin{2})
0254                 <span class="keyword">case</span> <span class="string">'char'</span>
0255                     midx = <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,varargin{2});
0256                 <span class="keyword">case</span> <span class="string">'cell'</span>
0257                     c = varargin{2};
0258                     <span class="keyword">for</span> i=1:length(c)
0259                         midx = [midx <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,c{i})];
0260                     <span class="keyword">end</span>
0261                 <span class="keyword">case</span> <span class="string">'double'</span> <span class="comment">%this covers single values and arrays of doubles</span>
0262                     midx = varargin{2};
0263                 <span class="keyword">otherwise</span>
0264                     error(<span class="string">'Metabolites in setDiffusion(layout,mets,values) must be ID''d as a char, a cell array of chars, a single index, or an array of indices'</span>);
0265             <span class="keyword">end</span>
0266             
0267             hasValue = false;
0268             <span class="keyword">if</span> nargin &gt; 2 &amp;&amp; (varargin{3}(1) || isnumeric(varargin{3}))
0269                 hasValue = true;
0270                 vals = varargin{3};
0271                 <span class="keyword">if</span> length(vals) == 1
0272                     vals = repmat(vals,length(midx),1);
0273                 <span class="keyword">end</span>
0274                 <span class="keyword">if</span> length(vals) ~= length(midx)
0275                     error(<span class="string">'The third argument in setDiffusion(layout,mets,values) must be empty, false, a single value, or of the same length as the list of mets'</span>);
0276                 <span class="keyword">end</span>
0277             <span class="keyword">end</span>
0278             
0279             <span class="keyword">for</span> i = 1:length(midx)
0280                 m = midx(i);
0281                 <span class="keyword">if</span> hasValue
0282                     self.diffusion_constants(m,1) = 1;
0283                     self.diffusion_constants(m,2) = vals(i);
0284                 <span class="keyword">else</span>
0285                     self.diffusion_constants(m,1) = 0;
0286                 <span class="keyword">end</span>
0287             <span class="keyword">end</span>
0288         <span class="keyword">end</span>
0289         
0290         <a name="_sub13" href="#_subfunctions" class="code">function self = setStaticMedia(varargin)</a>
0291             <span class="comment">%setStaticMedia(layout, x, y, metnames, values)</span>
0292             <span class="comment">%</span>
0293             <span class="comment">%Set if the given metabolites in media are static</span>
0294             <span class="comment">%</span>
0295             <span class="comment">%'x' and 'y' can be single integers or arrays specifying</span>
0296             <span class="comment">%coordinates. If exactly one is an array, the single value will</span>
0297             <span class="comment">%be paired with all members of the array. If both are arrays,</span>
0298             <span class="comment">%the shorter array will be repeated to match the longer.</span>
0299             <span class="comment">%</span>
0300             <span class="comment">%'metnames' can be a single metabolite name, a cell array of</span>
0301             <span class="comment">%metabolite names, a single metabolite index, or an array of</span>
0302             <span class="comment">%metabolite indexes</span>
0303             <span class="comment">%</span>
0304             <span class="comment">%'values' can be a single value, an array of values, false, or</span>
0305             <span class="comment">%not given. If false or not given, the metabolites will have their</span>
0306             <span class="comment">%&quot;set&quot; flag (the first dimension in diffusion_constants) turned</span>
0307             <span class="comment">%off. If a single value, all input metabolites will get that value</span>
0308             <span class="comment">%assigned. If an array, there must be one value per metabolite</span>
0309             self = varargin{1};
0310             x = varargin{2};
0311             y = varargin{3};
0312             <span class="comment">%check coordinate vector dimensions</span>
0313             <span class="comment">%first, linearize them and put them in the same orientation</span>
0314             x = x(1:end);
0315             y = y(1:end);
0316             [temp,xlen] = size(x);
0317             [temp,ylen] = size(y);
0318             <span class="comment">%if xlen == ylen, do nothing. Otherwise repeat the short one to</span>
0319             <span class="comment">%match the long one</span>
0320             <span class="keyword">if</span> (xlen &lt; ylen)
0321                 x = repmat(x,1,ylen);
0322                 x = x(1:ylen);
0323             <span class="keyword">end</span>
0324             <span class="keyword">if</span> (xlen &gt; ylen)
0325                 y = repmat(y,1,xlen);
0326                 y = y(1:xlen);
0327             <span class="keyword">end</span>
0328             
0329             midx = [];
0330             <span class="keyword">switch</span> class(varargin{4})
0331                 <span class="keyword">case</span> <span class="string">'char'</span>
0332                     midx = <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,varargin{4});
0333                 <span class="keyword">case</span> <span class="string">'cell'</span>
0334                     c = varargin{4};
0335                     <span class="keyword">for</span> i=1:length(c)
0336                         idx = <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,c{i});
0337                         <span class="keyword">if</span> isempty(idx)
0338                             self = self.addMets(c(i));
0339                             idx = <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,c{i});
0340                         <span class="keyword">end</span>
0341                         midx = [midx idx];
0342                     <span class="keyword">end</span>
0343                 <span class="keyword">case</span> <span class="string">'double'</span> <span class="comment">%this covers single values and arrays of doubles</span>
0344                     midx = varargin{4};
0345                 <span class="keyword">otherwise</span>
0346                     error(<span class="string">'Metabolites in setStaticMedia must be ID''d as a char, a cell array of chars, a single index, or an array of indices'</span>);
0347             <span class="keyword">end</span>
0348             
0349             hasValue = false;
0350             <span class="keyword">if</span> nargin &gt; 4 &amp;&amp; (varargin{5}(1) || isnumeric(varargin{5}))
0351                 hasValue = true;
0352                 vals = varargin{5};
0353                 <span class="keyword">if</span> length(vals) == 1
0354                     vals = repmat(vals,length(midx),1);
0355                 <span class="keyword">end</span>
0356                 <span class="keyword">if</span> length(vals) ~= length(midx)
0357                     error(<span class="string">'The fifth argument in setStaticMedia must be empty, false, a single value, or of the same length as the list of mets'</span>);
0358                 <span class="keyword">end</span>
0359             <span class="keyword">end</span>
0360             
0361             <span class="comment">%Don't just apply changes to self.static_media(midx,x,y,:)!</span>
0362             <span class="comment">%This will change values in every combination of values in x</span>
0363             <span class="comment">%and y. Instead, iterate over x and y so it's properly done</span>
0364             <span class="comment">%pairwise.</span>
0365             <span class="keyword">for</span> i = 1:length(x)
0366                 xi = x(i);
0367                 yi = y(i);
0368                 <span class="keyword">if</span> hasValue
0369                     self.static_media(midx,xi,yi,1) = 1;
0370                     self.static_media(midx,xi,yi,2) = vals;
0371                 <span class="keyword">else</span>
0372                     self.static_media(midx,xi,yi,1) = 0;
0373                 <span class="keyword">end</span>
0374             <span class="keyword">end</span>
0375         <span class="keyword">end</span>
0376         
0377         <span class="comment">%applyStaticMediaMask(layout,mask,metnames,values)</span>
0378         <span class="comment">%</span>
0379         <a name="_sub14" href="#_subfunctions" class="code">function self = applyStaticMediaMask(self, mask, metnames, values)</a>
0380             <span class="comment">%Set if the given metabolites in the media are static. Instead of</span>
0381             <span class="comment">%specifying x-y coordinates, 'mask' is a logical matrix of the</span>
0382             <span class="comment">%same dimensions as the layout. The static media will be set in</span>
0383             <span class="comment">%every position where mask(x,y) == true</span>
0384             <span class="comment">%</span>
0385             <span class="comment">%'metnames' can be a single metabolite name, a cell array of</span>
0386             <span class="comment">%metabolite names, a single metabolite index, or an array of</span>
0387             <span class="comment">%metabolite indexes</span>
0388             <span class="comment">%</span>
0389             <span class="comment">%'values' can be a single value, an array of values, false, or</span>
0390             <span class="comment">%not given. If false or not given, the metabolites will have their</span>
0391             <span class="comment">%&quot;set&quot; flag (the first dimension in diffusion_constants) turned</span>
0392             <span class="comment">%off. If a single value, all input metabolites will get that value</span>
0393             <span class="comment">%assigned. If an array, there must be one value per metabolite</span>
0394             
0395             <span class="comment">%simply convert the mask to coordinates then pass everything to</span>
0396             <span class="comment">%setStaticMedia()</span>
0397             [x,y] = find(mask);
0398             self = <a href="#_sub14" class="code" title="subfunction self = setStaticMedia(varargin)">setStaticMedia</a>(self,x,y,metnames,values);
0399         <span class="keyword">end</span>
0400         
0401         <span class="comment">%setMediaRefresh(layout, x, y, metnames, values)</span>
0402         <a name="_sub15" href="#_subfunctions" class="code">function self = setMediaRefresh(self, x, y, mets, values)</a>
0403             <span class="comment">%Set the amount to adjust media in the specified cells at each</span>
0404             <span class="comment">%timestep. The concentration in the cell will have the given value</span>
0405             <span class="comment">%added, so units of the values should be concentration.</span>
0406             <span class="comment">%</span>
0407             <span class="comment">%'x' and 'y' can be single integers or arrays specifying</span>
0408             <span class="comment">%coordinates. If exactly one is an array, the single value will</span>
0409             <span class="comment">%be paired with all members of the array. If both are arrays,</span>
0410             <span class="comment">%the shorter array will be repeated to match the longer.</span>
0411             <span class="comment">%</span>
0412             <span class="comment">%'metnames' can be a single metabolite name, a cell array of</span>
0413             <span class="comment">%metabolite names, a single metabolite index, or an array of</span>
0414             <span class="comment">%metabolite indexes</span>
0415             <span class="comment">%</span>
0416             <span class="comment">%'values' can be a single value, or an array of values If a</span>
0417             <span class="comment">%single value, all input metabolites will get that value</span>
0418             <span class="comment">%assigned. If an array, there must be one value per metabolite</span>
0419             
0420             <span class="comment">%check coordinate vector dimensions</span>
0421             <span class="comment">%first, linearize them and put them in the same orientation</span>
0422             x = x(1:end);
0423             y = y(1:end);
0424             [temp,xlen] = size(x);
0425             [temp,ylen] = size(y);
0426             <span class="comment">%if xlen == ylen, do nothing. Otherwise repeat the short one to</span>
0427             <span class="comment">%match the long one</span>
0428             <span class="keyword">if</span> (xlen &lt; ylen)
0429                 x = repmat(x,1,ylen);
0430                 x = x(1:ylen);
0431             <span class="keyword">end</span>
0432             <span class="keyword">if</span> (xlen &gt; ylen)
0433                 y = repmat(y,1,xlen);
0434                 y = y(1:xlen);
0435             <span class="keyword">end</span>
0436             
0437             midx = [];
0438             <span class="keyword">switch</span> class(mets)
0439                 <span class="keyword">case</span> <span class="string">'char'</span>
0440                     midx = <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,mets);
0441                 <span class="keyword">case</span> <span class="string">'cell'</span>
0442                     <span class="keyword">for</span> i=1:length(mets)
0443                         midx = [midx <a href="#_sub5" class="code" title="subfunction idx=metIdx(self,name)">metIdx</a>(self,mets{i})];
0444                     <span class="keyword">end</span>
0445                 <span class="keyword">case</span> <span class="string">'double'</span> <span class="comment">%this covers single values and arrays of doubles</span>
0446                     midx = mets;
0447                 <span class="keyword">otherwise</span>
0448                     error(<span class="string">'Metabolites in setMediaRefresh must be ID''d as a char, a cell array of chars, a single index, or an array of indices'</span>);
0449             <span class="keyword">end</span>
0450             
0451             vals = values;
0452             <span class="keyword">if</span> length(vals) == 1
0453                 vals = repmat(vals,length(midx),1);
0454             <span class="keyword">end</span>
0455             <span class="keyword">if</span> length(vals) ~= length(midx)
0456                 error(<span class="string">'The fifth argument in setMediaRefresh must be a single value or of the same length as the list of mets'</span>);
0457             <span class="keyword">end</span>
0458             
0459             <span class="comment">%Don't just apply changes to self.media_refresh(midx,x,y)!</span>
0460             <span class="comment">%This will change values in every combination of values in x</span>
0461             <span class="comment">%and y. Instead, iterate over x and y so it's properly done</span>
0462             <span class="comment">%pairwise.</span>
0463             <span class="keyword">for</span> i = 1:length(x)
0464                 xi = x(i);
0465                 yi = y(i);
0466                 vi = vals(i);
0467                 self.media_refresh(midx,xi,yi) = vi;
0468             <span class="keyword">end</span>
0469         <span class="keyword">end</span>
0470         
0471         
0472     <span class="keyword">end</span>
0473     
0474 <span class="keyword">end</span>
0475</pre></div>
<hr><address>Generated on Mon 12-Feb-2018 14:22:16 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>