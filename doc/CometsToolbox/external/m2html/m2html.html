<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of m2html</title>
  <meta name="keywords" content="m2html">
  <meta name="description" content="M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # CometsToolbox --><!-- ../menu.html external --><!-- menu.html m2html -->
<h1>m2html
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function m2html(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML
  M2HTML by itself generates an HTML documentation of the Matlab M-files found
  in the direct subdirectories of the current directory. HTML files are 
  written in a 'doc' directory (created if necessary). All the others options
  are set to default (in brackets in the following).
  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)
  sets multiple option values. The list of option names and default values is:
    o mFiles - Cell array of strings or character array containing the
       list of M-files and/or directories of M-files for which an HTML
       documentation will be built (use relative paths without backtracking).
       Launch M2HTML one directory above the directory your wanting to
       generate documentation for  [ &lt;all direct subdirectories&gt; ]
    o htmlDir - Top level directory for generated HTML files [ 'doc' ]
    o recursive - Process subdirectories recursively [ on | {off} ]
    o source - Include Matlab source code in the generated documentation
                               [ {on} | off ]
    o download - Add a link to download each M-file separately [ on | {off} ]
    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]
    o tabs - Replace '\t' (horizontal tab) in source code by n white space
        characters [ 0 ... {4} ... n ]
    o globalHypertextLinks - Hypertext links among separate Matlab 
        directories [ on | {off} ]
    o todo - Create a TODO list in each directory summarizing all the
        '% TODO %' lines found in Matlab code [ on | {off}]
    o graph - Compute a dependency graph using GraphViz [ on | {off}]
        'dot' required, see &lt;http://www.graphviz.org/&gt;
    o indexFile - Basename of the HTML index file [ 'index' ]
    o extension - Extension of generated HTML files [ '.html' ]
    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]
    o search - Add a PHP search engine [ on | {off}] - beta version!
    o ignoredDir - List of directories to be ignored [ {'.svn' 'cvs'} ]
    o save - Save current state after M-files parsing in 'm2html.mat' 
        in directory htmlDir [ on | {off}]
    o load - Load a previously saved '.mat' M2HTML state to generate HTML 
        files once again with possibly other options [ &lt;none&gt; ]
    o verbose - Verbose mode [ {on} | off ]

  For more information, please read the M2HTML tutorial and FAQ at:
    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;

  Examples:
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');
    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');
    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');
    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');

  See also <a href="mwizard.html" class="code" title="function mwizard(file)">MWIZARD</a>, <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">MDOT</a>, TEMPLATE.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>	TEMPLATE/GET Access data stored in a Template object</li><li><a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>	TEMPLATE/PARSE Fill in replacement fields with the class properties</li><li><a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>	TEMPLATE HTML Template Toolbox Constructor</li><li><a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>	MDOT - Export a dependency graph into DOT language</li><li><a href="../../../CometsToolbox/external/m2html/private/doxywrite.html" class="code" title="function doxywrite(filename, kw, statinfo, docinfo)">doxywrite</a>	DOXYWRITE Write a 'search.idx' file compatible with DOXYGEN</li><li><a href="../../../CometsToolbox/external/m2html/private/mexexts.html" class="code" title="function [ext, platform] = mexexts">mexexts</a>	MEXEXTS List of Mex files extensions</li><li><a href="../../../CometsToolbox/external/m2html/private/mfileparse.html" class="code" title="function s = mfileparse(mfile, mdirs, names, options)">mfileparse</a>	MFILEPARSE Parsing of an M-file to obtain synopsis, help and references</li><li><a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>	OPENFILE Open a file in read/write mode, catching errors</li><li><a href="../../../CometsToolbox/external/m2html/private/searchindex.html" class="code" title="function [s, freq] = searchindex(mfile, szmin)">searchindex</a>	SEARCHINDEX Compute keywords statistics of an M-file</li><li><a href="../../../CometsToolbox/external/m2html/private/splitcode.html" class="code" title="function splitc = splitcode(code)">splitcode</a>	SPLITCODE Split a line of Matlab code in string, comment and other</li><li><a href="../../../CometsToolbox/external/m2html/private/strtok.html" class="code" title="function [token, remainder, quotient] = strtok(string, delimiters)">strtok</a>	Modified version of STRTOK to also return the quotient</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="mwizard.html" class="code" title="function mwizard(file)">mwizard</a>	MWIZARD - M2HTML Graphical User Interface</li><li><a href="mwizard2.html" class="code" title="function mwizard(file)">mwizard2</a>	MWIZARD - M2HTML Graphical User Interface</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)</a></li><li><a href="#_sub2" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a></li><li><a href="#_sub3" class="code">function s = backtomaster(mdir)</a></li><li><a href="#_sub4" class="code">function ldir = splitpath(p)</a></li><li><a href="#_sub5" class="code">function name = extractname(synopsis)</a></li><li><a href="#_sub6" class="code">function f = fullurl(varargin)</a></li><li><a href="#_sub7" class="code">function str = escapeblank(str)</a></li><li><a href="#_sub8" class="code">function str = entity(str)</a></li><li><a href="#_sub9" class="code">function str = horztab(str,n)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function m2html(varargin)</a>
0002 <span class="comment">%M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</span>
0003 <span class="comment">%  M2HTML by itself generates an HTML documentation of the Matlab M-files found</span>
0004 <span class="comment">%  in the direct subdirectories of the current directory. HTML files are</span>
0005 <span class="comment">%  written in a 'doc' directory (created if necessary). All the others options</span>
0006 <span class="comment">%  are set to default (in brackets in the following).</span>
0007 <span class="comment">%  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)</span>
0008 <span class="comment">%  sets multiple option values. The list of option names and default values is:</span>
0009 <span class="comment">%    o mFiles - Cell array of strings or character array containing the</span>
0010 <span class="comment">%       list of M-files and/or directories of M-files for which an HTML</span>
0011 <span class="comment">%       documentation will be built (use relative paths without backtracking).</span>
0012 <span class="comment">%       Launch M2HTML one directory above the directory your wanting to</span>
0013 <span class="comment">%       generate documentation for  [ &lt;all direct subdirectories&gt; ]</span>
0014 <span class="comment">%    o htmlDir - Top level directory for generated HTML files [ 'doc' ]</span>
0015 <span class="comment">%    o recursive - Process subdirectories recursively [ on | {off} ]</span>
0016 <span class="comment">%    o source - Include Matlab source code in the generated documentation</span>
0017 <span class="comment">%                               [ {on} | off ]</span>
0018 <span class="comment">%    o download - Add a link to download each M-file separately [ on | {off} ]</span>
0019 <span class="comment">%    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]</span>
0020 <span class="comment">%    o tabs - Replace '\t' (horizontal tab) in source code by n white space</span>
0021 <span class="comment">%        characters [ 0 ... {4} ... n ]</span>
0022 <span class="comment">%    o globalHypertextLinks - Hypertext links among separate Matlab</span>
0023 <span class="comment">%        directories [ on | {off} ]</span>
0024 <span class="comment">%    o todo - Create a TODO list in each directory summarizing all the</span>
0025 <span class="comment">%        '% TODO %' lines found in Matlab code [ on | {off}]</span>
0026 <span class="comment">%    o graph - Compute a dependency graph using GraphViz [ on | {off}]</span>
0027 <span class="comment">%        'dot' required, see &lt;http://www.graphviz.org/&gt;</span>
0028 <span class="comment">%    o indexFile - Basename of the HTML index file [ 'index' ]</span>
0029 <span class="comment">%    o extension - Extension of generated HTML files [ '.html' ]</span>
0030 <span class="comment">%    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]</span>
0031 <span class="comment">%    o search - Add a PHP search engine [ on | {off}] - beta version!</span>
0032 <span class="comment">%    o ignoredDir - List of directories to be ignored [ {'.svn' 'cvs'} ]</span>
0033 <span class="comment">%    o save - Save current state after M-files parsing in 'm2html.mat'</span>
0034 <span class="comment">%        in directory htmlDir [ on | {off}]</span>
0035 <span class="comment">%    o load - Load a previously saved '.mat' M2HTML state to generate HTML</span>
0036 <span class="comment">%        files once again with possibly other options [ &lt;none&gt; ]</span>
0037 <span class="comment">%    o verbose - Verbose mode [ {on} | off ]</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%  For more information, please read the M2HTML tutorial and FAQ at:</span>
0040 <span class="comment">%    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%  Examples:</span>
0043 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');</span>
0044 <span class="comment">%    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');</span>
0045 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');</span>
0046 <span class="comment">%    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');</span>
0047 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');</span>
0048 <span class="comment">%    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');</span>
0049 <span class="comment">%</span>
0050 <span class="comment">%  See also MWIZARD, MDOT, TEMPLATE.</span>
0051 
0052 <span class="comment">%  Copyright (C) 2005 Guillaume Flandin &lt;Guillaume@artefact.tk&gt;</span>
0053 <span class="comment">%  $Revision: 1.5 $Date: 2005/05/01 16:15:30 $</span>
0054 
0055 <span class="comment">%  This program is free software; you can redistribute it and/or</span>
0056 <span class="comment">%  modify it under the terms of the GNU General Public License</span>
0057 <span class="comment">%  as published by the Free Software Foundation; either version 2</span>
0058 <span class="comment">%  of the License, or any later version.</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%  This program is distributed in the hope that it will be useful,</span>
0061 <span class="comment">%  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0062 <span class="comment">%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0063 <span class="comment">%  GNU General Public License for more details.</span>
0064 <span class="comment">%</span>
0065 <span class="comment">%  You should have received a copy of the GNU General Public License</span>
0066 <span class="comment">%  along with this program; if not, write to the Free Software</span>
0067 <span class="comment">%  Foundation Inc, 59 Temple Pl. - Suite 330, Boston, MA 02111-1307, USA.</span>
0068 
0069 <span class="comment">%  Suggestions for improvement and fixes are always welcome, although no</span>
0070 <span class="comment">%  guarantee is made whether and when they will be implemented.</span>
0071 <span class="comment">%  Send requests to &lt;Guillaume@artefact.tk&gt;</span>
0072 
0073 <span class="comment">%  For tips on how to write Matlab code, see:</span>
0074 <span class="comment">%     * MATLAB Programming Style Guidelines, by R. Johnson:</span>
0075 <span class="comment">%       &lt;http://www.datatool.com/prod02.htm&gt;</span>
0076 <span class="comment">%     * For tips on creating help for your m-files 'type help.m'.</span>
0077 <span class="comment">%     * Matlab documentation on M-file Programming:</span>
0078 <span class="comment">%  &lt;http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/ch_funh8.html&gt;</span>
0079 
0080 <span class="comment">%  This function uses the Template class so that you can fully customize</span>
0081 <span class="comment">%  the output. You can modify .tpl files in templates/blue/ or create new</span>
0082 <span class="comment">%  templates in a new directory.</span>
0083 <span class="comment">%  See the template class documentation for more details.</span>
0084 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/template/&gt;</span>
0085 
0086 <span class="comment">%  Latest information on M2HTML is available on the web through:</span>
0087 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0088 
0089 <span class="comment">%  Other Matlab to HTML converters available on the web:</span>
0090 <span class="comment">%  1/ mat2html.pl, J.C. Kantor, in Perl, 1995:</span>
0091 <span class="comment">%     &lt;http://fresh.t-systems-sfr.com/unix/src/www/mat2html&gt;</span>
0092 <span class="comment">%  2/ htmltools, B. Alsberg, in Matlab, 1997:</span>
0093 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=175&gt;</span>
0094 <span class="comment">%  3/ mtree2html2001, H. Pohlheim, in Perl, 1996, 2001:</span>
0095 <span class="comment">%     &lt;http://www.pohlheim.com/perl_main.html#matlabdocu&gt;</span>
0096 <span class="comment">%  4/ MatlabCodeColorizer, S. Faridani, in C#, 2005:</span>
0097 <span class="comment">%     &lt;http://www.pitchup.com/matlabcolorizer/&gt;</span>
0098 <span class="comment">%  5/ Highlight, G. Flandin, in Matlab, 2003:</span>
0099 <span class="comment">%     &lt;http://www.artefact.tk/software/matlab/highlight/&gt;</span>
0100 <span class="comment">%  6/ mdoc, P. Brinkmann, in Matlab, 2003:</span>
0101 <span class="comment">%     &lt;http://www.math.uiuc.edu/~brinkman/software/mdoc/&gt;</span>
0102 <span class="comment">%  7/ Ocamaweb, Miriad Technologies, in Ocaml, 2002:</span>
0103 <span class="comment">%     &lt;http://ocamaweb.sourceforge.net/&gt;</span>
0104 <span class="comment">%  8/ Matdoc, M. Kaminsky, in Perl, 2003:</span>
0105 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=3498&gt;</span>
0106 <span class="comment">%  9/ Matlab itself, The Mathworks Inc, with HELPWIN, DOC and PUBLISH (R14)</span>
0107 
0108 <span class="comment">%-------------------------------------------------------------------------------</span>
0109 <span class="comment">%- Set up options and default parameters</span>
0110 <span class="comment">%-------------------------------------------------------------------------------</span>
0111 t0 = clock; <span class="comment">% for statistics</span>
0112 msgInvalidPair = <span class="string">'Bad value for argument: ''%s'''</span>;
0113 
0114 options = struct(<span class="string">'verbose'</span>, 1,<span class="keyword">...</span>
0115                  <span class="string">'mFiles'</span>, {{<span class="string">'.'</span>}},<span class="keyword">...</span>
0116                  <span class="string">'htmlDir'</span>, <span class="string">'doc'</span>,<span class="keyword">...</span>
0117                  <span class="string">'recursive'</span>, 0,<span class="keyword">...</span>
0118                  <span class="string">'source'</span>, 1,<span class="keyword">...</span>
0119                  <span class="string">'download'</span>,0,<span class="keyword">...</span>
0120                  <span class="string">'syntaxHighlighting'</span>, 1,<span class="keyword">...</span>
0121                  <span class="string">'tabs'</span>, 4,<span class="keyword">...</span>
0122                  <span class="string">'globalHypertextLinks'</span>, 0,<span class="keyword">...</span>
0123                  <span class="string">'graph'</span>, 0,<span class="keyword">...</span>
0124                  <span class="string">'todo'</span>, 0,<span class="keyword">...</span>
0125                  <span class="string">'load'</span>, 0,<span class="keyword">...</span>
0126                  <span class="string">'save'</span>, 0,<span class="keyword">...</span>
0127                  <span class="string">'search'</span>, 0,<span class="keyword">...</span>
0128                  <span class="string">'helptocxml'</span>, 0,<span class="keyword">...</span>
0129                  <span class="string">'indexFile'</span>, <span class="string">'index'</span>,<span class="keyword">...</span>
0130                  <span class="string">'extension'</span>, <span class="string">'.html'</span>,<span class="keyword">...</span>
0131                  <span class="string">'template'</span>, <span class="string">'blue'</span>,<span class="keyword">...</span>
0132                  <span class="string">'rootdir'</span>, pwd,<span class="keyword">...</span>
0133                  <span class="string">'ignoredDir'</span>, {{<span class="string">'.svn'</span> <span class="string">'cvs'</span>}}, <span class="keyword">...</span>
0134                  <span class="string">'language'</span>, <span class="string">'english'</span>);
0135 
0136 <span class="keyword">if</span> nargin == 1 &amp; isstruct(varargin{1})
0137     paramlist = [ fieldnames(varargin{1}) <span class="keyword">...</span>
0138                   struct2cell(varargin{1}) ]';
0139     paramlist = { paramlist{:} };
0140 <span class="keyword">else</span>
0141     <span class="keyword">if</span> mod(nargin,2)
0142         error(<span class="string">'Invalid parameter/value pair arguments.'</span>);
0143     <span class="keyword">end</span>
0144     paramlist = varargin;
0145 <span class="keyword">end</span>
0146 
0147 optionsnames = lower(fieldnames(options));
0148 <span class="keyword">for</span> i=1:2:length(paramlist)
0149     pname = paramlist{i};
0150     pvalue = paramlist{i+1};
0151     ind = strmatch(lower(pname),optionsnames);
0152     <span class="keyword">if</span> isempty(ind)
0153         error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0154     <span class="keyword">elseif</span> length(ind) &gt; 1
0155         error([<span class="string">'Ambiguous parameter: '''</span> pname <span class="string">'''.'</span>]);
0156     <span class="keyword">end</span>
0157     <span class="keyword">switch</span>(optionsnames{ind})
0158         <span class="keyword">case</span> <span class="string">'verbose'</span>
0159             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0160                 options.verbose = 1;
0161             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0162                 options.verbose = 0;
0163             <span class="keyword">else</span>
0164                 error(sprintf(msgInvalidPair,pname));
0165             <span class="keyword">end</span>
0166         <span class="keyword">case</span> <span class="string">'mfiles'</span>
0167             <span class="keyword">if</span> iscellstr(pvalue)
0168                 options.mFiles = pvalue;
0169             <span class="keyword">elseif</span> ischar(pvalue)
0170                 options.mFiles = cellstr(pvalue);
0171             <span class="keyword">else</span>
0172                 error(sprintf(msgInvalidPair,pname));
0173             <span class="keyword">end</span>
0174             options.load = 0;
0175         <span class="keyword">case</span> <span class="string">'htmldir'</span>
0176             <span class="keyword">if</span> ischar(pvalue)
0177                 <span class="keyword">if</span> isempty(pvalue),
0178                     options.htmlDir = <span class="string">'.'</span>;
0179                 <span class="keyword">else</span>
0180                     options.htmlDir = pvalue;
0181                 <span class="keyword">end</span>
0182             <span class="keyword">else</span>
0183                 error(sprintf(msgInvalidPair,pname));
0184             <span class="keyword">end</span>
0185         <span class="keyword">case</span> <span class="string">'recursive'</span>
0186             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0187                 options.recursive = 1;
0188             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0189                 options.recursive = 0;
0190             <span class="keyword">else</span>
0191                 error(sprintf(msgInvalidPair,pname));
0192             <span class="keyword">end</span>
0193             options.load = 0;
0194         <span class="keyword">case</span> <span class="string">'source'</span>
0195             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0196                 options.source = 1;
0197             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0198                 options.source = 0;
0199             <span class="keyword">else</span>
0200                 error(sprintf(msgInvalidPair,pname));
0201             <span class="keyword">end</span>
0202         <span class="keyword">case</span> <span class="string">'download'</span>
0203             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0204                 options.download = 1;
0205             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0206                 options.download = 0;
0207             <span class="keyword">else</span>
0208                 error(sprintf(msgInvalidPair,pname));
0209             <span class="keyword">end</span>
0210         <span class="keyword">case</span> <span class="string">'syntaxhighlighting'</span>
0211             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0212                 options.syntaxHighlighting = 1;
0213             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0214                 options.syntaxHighlighting = 0;
0215             <span class="keyword">else</span>
0216                 error(sprintf(msgInvalidPair,pname));
0217             <span class="keyword">end</span>
0218         <span class="keyword">case</span> <span class="string">'tabs'</span>
0219             <span class="keyword">if</span> pvalue &gt;= 0
0220                 options.tabs = pvalue;
0221             <span class="keyword">else</span>
0222                 error(sprintf(msgInvalidPair,pname));
0223             <span class="keyword">end</span>
0224         <span class="keyword">case</span> <span class="string">'globalhypertextlinks'</span>
0225             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0226                 options.globalHypertextLinks = 1;
0227             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0228                 options.globalHypertextLinks = 0;
0229             <span class="keyword">else</span>
0230                 error(sprintf(msgInvalidPair,pname));
0231             <span class="keyword">end</span>
0232             options.load = 0;
0233         <span class="keyword">case</span> <span class="string">'graph'</span>
0234             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0235                 options.graph = 1;
0236             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0237                 options.graph = 0;
0238             <span class="keyword">else</span>
0239                 error(sprintf(msgInvalidPair,pname));
0240             <span class="keyword">end</span>
0241         <span class="keyword">case</span> <span class="string">'todo'</span>
0242             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0243                 options.todo = 1;
0244             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0245                 options.todo = 0;
0246             <span class="keyword">else</span>
0247                 error(sprintf(msgInvalidPair,pname));
0248             <span class="keyword">end</span>
0249         <span class="keyword">case</span> <span class="string">'load'</span>
0250             <span class="keyword">if</span> ischar(pvalue)
0251                 <span class="keyword">if</span> exist(pvalue) == 7 <span class="comment">% directory provided</span>
0252                     pvalue = fullfile(pvalue,<span class="string">'m2html.mat'</span>);
0253                 <span class="keyword">end</span>         
0254                 <span class="keyword">try</span>
0255                     load(pvalue);
0256                 <span class="keyword">catch</span>
0257                     error(sprintf(<span class="string">'Unable to load %s.'</span>, pvalue));
0258                 <span class="keyword">end</span>
0259                 options.load = 1;
0260                 [dummy options.template] = fileparts(options.template);
0261             <span class="keyword">else</span>
0262                 error(sprintf(msgInvalidPair,pname));
0263             <span class="keyword">end</span>
0264         <span class="keyword">case</span> <span class="string">'save'</span>
0265             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0266                 options.save = 1;
0267             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0268                 options.save = 0;
0269             <span class="keyword">else</span>
0270                 error(sprintf(msgInvalidPair,pname));
0271             <span class="keyword">end</span>
0272         <span class="keyword">case</span> <span class="string">'search'</span>
0273             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0274                 options.search = 1;
0275             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0276                 options.search = 0;
0277             <span class="keyword">else</span>
0278                 error(sprintf(msgInvalidPair,pname));
0279             <span class="keyword">end</span>
0280         <span class="keyword">case</span> <span class="string">'helptocxml'</span>
0281             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0282                 options.helptocxml = 1;
0283             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0284                 options.helptocxml = 0;
0285             <span class="keyword">else</span>
0286                 error(sprintf(msgInvalidPair,pname));
0287             <span class="keyword">end</span>
0288         <span class="keyword">case</span> <span class="string">'indexfile'</span>
0289             <span class="keyword">if</span> ischar(pvalue)
0290                 options.indexFile = pvalue;
0291             <span class="keyword">else</span>
0292                 error(sprintf(msgInvalidPair,pname));
0293             <span class="keyword">end</span>
0294         <span class="keyword">case</span> <span class="string">'extension'</span>
0295             <span class="keyword">if</span> ischar(pvalue) &amp; pvalue(1) == <span class="string">'.'</span>
0296                 options.extension = pvalue;
0297             <span class="keyword">else</span>
0298                 error(sprintf(msgInvalidPair,pname));
0299             <span class="keyword">end</span>
0300         <span class="keyword">case</span> <span class="string">'template'</span>
0301             <span class="keyword">if</span> ischar(pvalue)
0302                 options.template = pvalue;
0303             <span class="keyword">else</span>
0304                 error(sprintf(msgInvalidPair,pname));
0305             <span class="keyword">end</span>
0306         <span class="keyword">case</span> <span class="string">'ignoreddir'</span>
0307             <span class="keyword">if</span> iscellstr(pvalue)
0308                 options.ignoredDir = pvalue;
0309             <span class="keyword">elseif</span> ischar(pvalue)
0310                 options.ignoredDir = cellstr(pvalue);
0311             <span class="keyword">else</span>
0312                 error(sprintf(msgInvalidPair,pname));
0313             <span class="keyword">end</span>
0314         <span class="keyword">case</span> <span class="string">'language'</span>
0315             <span class="keyword">if</span> ischar(pvalue)
0316                 options.language = pvalue;
0317             <span class="keyword">else</span>
0318                 error(sprintf(msgInvalidPair,pname));
0319             <span class="keyword">end</span>
0320         <span class="keyword">otherwise</span>
0321             error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0322     <span class="keyword">end</span>
0323 <span class="keyword">end</span>
0324 
0325 <span class="comment">%-------------------------------------------------------------------------------</span>
0326 <span class="comment">%- Get template files location</span>
0327 <span class="comment">%-------------------------------------------------------------------------------</span>
0328 s = fileparts(which(mfilename));
0329 options.template = fullfile(s,<span class="string">'templates'</span>,options.template);
0330 <span class="keyword">if</span> exist(options.template) ~= 7
0331     error(<span class="string">'[Template] Unknown template.'</span>);
0332 <span class="keyword">end</span>
0333 
0334 <span class="comment">%-------------------------------------------------------------------------------</span>
0335 <span class="comment">%- Get list of M-files</span>
0336 <span class="comment">%-------------------------------------------------------------------------------</span>
0337 <span class="keyword">if</span> ~options.load
0338     <span class="keyword">if</span> strcmp(options.mFiles,<span class="string">'.'</span>)
0339         d = dir(pwd); d = {d([d.isdir]).name};
0340         options.mFiles = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> options.ignoredDir{:}})}};
0341     <span class="keyword">end</span>
0342     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)">getmfiles</a>(options.mFiles,{},options.recursive,options.ignoredDir);
0343     <span class="keyword">if</span> ~length(mfiles), fprintf(<span class="string">'Nothing to be done.\n'</span>); <span class="keyword">return</span>; <span class="keyword">end</span>
0344     <span class="keyword">if</span> options.verbose,
0345         fprintf(<span class="string">'Found %d M-files.\n'</span>,length(mfiles));
0346     <span class="keyword">end</span>
0347     mfiles = sort(mfiles); <span class="comment">% sort list of M-files in dictionary order</span>
0348 <span class="keyword">end</span>
0349 
0350 <span class="comment">%-------------------------------------------------------------------------------</span>
0351 <span class="comment">%- Get list of (unique) directories and (unique) names</span>
0352 <span class="comment">%-------------------------------------------------------------------------------</span>
0353 <span class="keyword">if</span> ~options.load
0354     mdirs = {};
0355     names = {};
0356     <span class="keyword">for</span> i=1:length(mfiles)
0357         [mdirs{i}, names{i}] = fileparts(mfiles{i});
0358         <span class="keyword">if</span> isempty(mdirs{i}), mdirs{i} = <span class="string">'.'</span>; <span class="keyword">end</span>
0359     <span class="keyword">end</span>
0360 
0361     mdir = unique(mdirs);
0362     <span class="keyword">if</span> options.verbose,
0363         fprintf(<span class="string">'Found %d unique Matlab directories.\n'</span>,length(mdir));
0364     <span class="keyword">end</span>
0365 
0366     name = names;
0367     <span class="comment">%name = unique(names); % output is sorted</span>
0368     <span class="comment">%if options.verbose,</span>
0369     <span class="comment">%    fprintf('Found %d unique Matlab files.\n',length(name));</span>
0370     <span class="comment">%end</span>
0371 <span class="keyword">end</span>
0372 
0373 <span class="comment">%-------------------------------------------------------------------------------</span>
0374 <span class="comment">%- Create output directory, if necessary</span>
0375 <span class="comment">%-------------------------------------------------------------------------------</span>
0376 <span class="keyword">if</span> isempty(dir(options.htmlDir))                                               
0377     <span class="comment">%- Create the top level output directory</span>
0378     <span class="keyword">if</span> options.verbose                                                         
0379         fprintf(<span class="string">'Creating directory %s...\n'</span>,options.htmlDir);                 
0380     <span class="keyword">end</span>                                                                        
0381     <span class="keyword">if</span> options.htmlDir(end) == filesep,                                        
0382         options.htmlDir(end) = [];                                             
0383     <span class="keyword">end</span>                                                                        
0384     [pathdir, namedir] = fileparts(options.htmlDir);                           
0385     <span class="keyword">if</span> isempty(pathdir)                                                        
0386         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                                        
0387     <span class="keyword">else</span>                                                                       
0388         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(pathdir), <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                               
0389     <span class="keyword">end</span>                                                                        
0390     <span class="keyword">if</span> ~status, error(msg); <span class="keyword">end</span>                                                                
0391 <span class="keyword">end</span>                                                                            
0392 
0393 <span class="comment">%-------------------------------------------------------------------------------</span>
0394 <span class="comment">%- Get synopsis, H1 line, script/function, subroutines, cross-references, todo</span>
0395 <span class="comment">%-------------------------------------------------------------------------------</span>
0396 <span class="keyword">if</span> ~options.load
0397     synopsis   = cell(size(mfiles));
0398     h1line     = cell(size(mfiles));
0399     subroutine = cell(size(mfiles));
0400     hrefs      = sparse(length(mfiles), length(mfiles));
0401     todo       = struct(<span class="string">'mfile'</span>,[], <span class="string">'line'</span>,[], <span class="string">'comment'</span>,{{}});
0402     ismex      = zeros(length(mfiles), length(<a href="../../../CometsToolbox/external/m2html/private/mexexts.html" class="code" title="function [ext, platform] = mexexts">mexexts</a>));
0403     statlist   = {};
0404     statinfo   = sparse(1,length(mfiles));
0405     kw         = cell(size(mfiles));
0406     freq       = cell(size(mfiles));
0407 
0408     <span class="keyword">for</span> i=1:length(mfiles)
0409         <span class="keyword">if</span> options.verbose
0410             fprintf(<span class="string">'Processing file %s...'</span>,mfiles{i});
0411         <span class="keyword">end</span>
0412         s = <a href="../../../CometsToolbox/external/m2html/private/mfileparse.html" class="code" title="function s = mfileparse(mfile, mdirs, names, options)">mfileparse</a>(mfiles{i}, mdirs, names, options);
0413         synopsis{i}   = s.synopsis;
0414         h1line{i}     = s.h1line;
0415         subroutine{i} = s.subroutine;
0416         hrefs(i,:)    = s.hrefs;
0417         todo.mfile    = [todo.mfile repmat(i,1,length(s.todo.line))];
0418         todo.line     = [todo.line s.todo.line];
0419         todo.comment  = {todo.comment{:} s.todo.comment{:}};
0420         ismex(i,:)    = s.ismex;
0421         <span class="keyword">if</span> options.search
0422             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'search...'</span>); <span class="keyword">end</span>
0423             [kw{i}, freq{i}] = <a href="../../../CometsToolbox/external/m2html/private/searchindex.html" class="code" title="function [s, freq] = searchindex(mfile, szmin)">searchindex</a>(mfiles{i});
0424             statlist = union(statlist, kw{i});
0425         <span class="keyword">end</span>
0426         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0427     <span class="keyword">end</span>
0428     hrefs = hrefs &gt; 0;
0429     <span class="keyword">if</span> options.search
0430         <span class="keyword">if</span> options.verbose
0431             fprintf(<span class="string">'Creating the search index...'</span>);
0432         <span class="keyword">end</span>
0433         statinfo = sparse(length(statlist),length(mfiles));
0434         <span class="keyword">for</span> i=1:length(mfiles)
0435             i1 = find(ismember(statlist, kw{i}));
0436             i2 = repmat(i,1,length(i1));
0437             <span class="keyword">if</span> ~isempty(i1)
0438                 statinfo(sub2ind(size(statinfo),i1,i2)) = freq{i};
0439             <span class="keyword">end</span>
0440             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'.'</span>); <span class="keyword">end</span>
0441         <span class="keyword">end</span>
0442         clear kw freq;
0443         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0444     <span class="keyword">end</span>
0445 <span class="keyword">end</span>
0446 
0447 <span class="comment">%-------------------------------------------------------------------------------</span>
0448 <span class="comment">%- Save M-filenames and cross-references for further analysis</span>
0449 <span class="comment">%-------------------------------------------------------------------------------</span>
0450 matfilesave = <span class="string">'m2html.mat'</span>;
0451 
0452 <span class="keyword">if</span> options.save
0453     <span class="keyword">if</span> options.verbose
0454         fprintf(<span class="string">'Saving MAT file %s...\n'</span>,matfilesave);
0455     <span class="keyword">end</span>
0456     save(fullfile(options.htmlDir,matfilesave), <span class="keyword">...</span>
0457         <span class="string">'mfiles'</span>, <span class="string">'names'</span>, <span class="string">'mdirs'</span>, <span class="string">'name'</span>, <span class="string">'mdir'</span>, <span class="string">'options'</span>, <span class="keyword">...</span>
0458         <span class="string">'hrefs'</span>, <span class="string">'synopsis'</span>, <span class="string">'h1line'</span>, <span class="string">'subroutine'</span>, <span class="string">'todo'</span>, <span class="string">'ismex'</span>, <span class="keyword">...</span>
0459         <span class="string">'statlist'</span>, <span class="string">'statinfo'</span>);
0460 <span class="keyword">end</span>
0461 
0462 <span class="comment">%-------------------------------------------------------------------------------</span>
0463 <span class="comment">%- Setup the output directories</span>
0464 <span class="comment">%-------------------------------------------------------------------------------</span>
0465 <span class="keyword">for</span> i=1:length(mdir)
0466     <span class="keyword">if</span> exist(fullfile(options.htmlDir,mdir{i})) ~= 7
0467         ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
0468         <span class="keyword">for</span> j=1:length(ldir)
0469             <span class="keyword">if</span> exist(fullfile(options.htmlDir,ldir{1:j})) ~= 7
0470                 <span class="comment">%- Create the output directory</span>
0471                 <span class="keyword">if</span> options.verbose
0472                     fprintf(<span class="string">'Creating directory %s...\n'</span>,<span class="keyword">...</span>
0473                             fullfile(options.htmlDir,ldir{1:j}));
0474                 <span class="keyword">end</span>
0475                 <span class="keyword">if</span> j == 1
0476                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0477                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(ldir{1}));
0478                 <span class="keyword">else</span>
0479                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0480                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(fullfile(ldir{1:j})));
0481                 <span class="keyword">end</span>
0482                 <span class="comment">%error(msg);</span>
0483             <span class="keyword">end</span>
0484         <span class="keyword">end</span>
0485     <span class="keyword">end</span>
0486 <span class="keyword">end</span>
0487 
0488 <span class="comment">%-------------------------------------------------------------------------------</span>
0489 <span class="comment">%- Write the master index file</span>
0490 <span class="comment">%-------------------------------------------------------------------------------</span>
0491 tpl_master = <span class="string">'master.tpl'</span>;
0492 tpl_master_identifier_nbyline = 4;
0493 php_search = <span class="string">'search.php'</span>;
0494 dotbase = <span class="string">'graph'</span>;
0495 
0496 <span class="comment">%- Create the HTML template</span>
0497 tpl = <a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0498 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MASTER'</span>,tpl_master);
0499 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'rowdir'</span>,<span class="string">'rowdirs'</span>);
0500 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'idrow'</span>,<span class="string">'idrows'</span>);
0501 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'idrow'</span>,<span class="string">'idcolumn'</span>,<span class="string">'idcolumns'</span>);
0502 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'search'</span>,<span class="string">'searchs'</span>);
0503 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0504 
0505 <span class="comment">%- Open for writing the HTML master index file</span>
0506 curfile = fullfile(options.htmlDir,[options.indexFile options.extension]);
0507 <span class="keyword">if</span> options.verbose
0508     fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0509 <span class="keyword">end</span>
0510 fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0511 
0512 <span class="comment">%- Set some template variables</span>
0513 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0514                             datestr(now,13)]);
0515 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0516 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DIRS'</span>, sprintf(<span class="string">'%s '</span>,mdir{:}));
0517 
0518 <span class="comment">%- Print list of unique directories</span>
0519 <span class="keyword">for</span> i=1:length(mdir)
0520     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_DIR'</span>,<span class="keyword">...</span>
0521               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdir{i},[options.indexFile options.extension]));
0522     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DIR'</span>,mdir{i});
0523     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rowdirs'</span>,<span class="string">'rowdir'</span>,1);
0524 <span class="keyword">end</span>
0525 
0526 <span class="comment">%- Print full list of M-files (sorted by column)</span>
0527 [sortnames, ind] = sort(names);
0528 m_mod = mod(length(sortnames), tpl_master_identifier_nbyline);
0529 ind = [ind zeros(1,tpl_master_identifier_nbyline-m_mod)];
0530 m_floor = floor(length(ind) / tpl_master_identifier_nbyline);
0531 ind = reshape(ind,m_floor,tpl_master_identifier_nbyline)';
0532 
0533 <span class="keyword">for</span> i=1:prod(size(ind))
0534     <span class="keyword">if</span> ind(i)
0535         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="keyword">...</span>
0536             <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{ind(i)},[names{ind(i)} options.extension]));
0537         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,mdirs{ind(i)});
0538         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,names{ind(i)});
0539         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0540     <span class="keyword">else</span>
0541         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="string">''</span>);
0542         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,<span class="string">''</span>);
0543         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,<span class="string">''</span>);
0544         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0545     <span class="keyword">end</span>
0546     <span class="keyword">if</span> mod(i,tpl_master_identifier_nbyline) == 0
0547         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'idrows'</span>,<span class="string">'idrow'</span>,1);
0548         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'idcolumns'</span>,<span class="string">''</span>);
0549     <span class="keyword">end</span>
0550 <span class="keyword">end</span>
0551 
0552 <span class="comment">%- Add a search form if necessary</span>
0553 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'searchs'</span>,<span class="string">''</span>);
0554 <span class="keyword">if</span> options.search
0555     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0556     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'searchs'</span>,<span class="string">'search'</span>,1);
0557 <span class="keyword">end</span>
0558 
0559 <span class="comment">%- Link to a full dependency graph, if necessary</span>
0560 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0561 <span class="keyword">if</span> options.graph &amp; options.globalHypertextLinks &amp; length(mdir) &gt; 1
0562     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0563     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0564 <span class="keyword">end</span>
0565 
0566 <span class="comment">%- Print the template in the HTML file</span>
0567 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MASTER'</span>);
0568 fprintf(fid,<span class="string">'%s'</span>,<a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0569 fclose(fid);
0570 
0571 <span class="comment">%-------------------------------------------------------------------------------</span>
0572 <span class="comment">%- Copy template files (CSS, images, ...)</span>
0573 <span class="comment">%-------------------------------------------------------------------------------</span>
0574 <span class="comment">% Get list of files</span>
0575 d = dir(options.template);
0576 d = {d(~[d.isdir]).name};
0577 <span class="comment">% Copy files</span>
0578 <span class="keyword">for</span> i=1:length(d)
0579     [p, n, ext] = fileparts(d{i});
0580     <span class="keyword">if</span> ~strcmp(ext,<span class="string">'.tpl'</span>) <span class="keyword">...</span><span class="comment"> % do not copy .tpl files</span>
0581        &amp; ~strcmp([n ext],<span class="string">'Thumbs.db'</span>) <span class="comment">% do not copy this Windows generated file</span>
0582         <span class="keyword">if</span> isempty(dir(fullfile(options.htmlDir,d{i})))
0583             <span class="keyword">if</span> options.verbose
0584                 fprintf(<span class="string">'Copying template file %s...\n'</span>,d{i});
0585             <span class="keyword">end</span>
0586             <span class="comment">%- there is a bug with &lt;copyfile&gt; in Matlab 6.5 :</span>
0587             <span class="comment">%   http://www.mathworks.com/support/solutions/data/1-1B5JY.html</span>
0588             <span class="comment">%- and &lt;copyfile&gt; does not overwrite files even if newer...</span>
0589             [status, errmsg] = copyfile(fullfile(options.template,d{i}),<span class="keyword">...</span>
0590                                         options.htmlDir);
0591             <span class="comment">%- If you encounter this bug, please uncomment one of the following lines</span>
0592             <span class="comment">% eval(['!cp -rf ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0593             <span class="comment">% eval(['!copy ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0594             <span class="comment">% status = 1;</span>
0595             <span class="keyword">if</span> ~status
0596                 <span class="keyword">if</span> ~isempty(errmsg)
0597                     error(errmsg)
0598                 <span class="keyword">else</span>
0599                     warning(sprintf([<span class="string">'&lt;copyfile&gt; failed to do its job...\n'</span> <span class="keyword">...</span>
0600                 <span class="string">'This is a known bug in Matlab 6.5 (R13).\n'</span> <span class="keyword">...</span>
0601                 <span class="string">'See http://www.mathworks.com/support/solutions/data/1-1B5JY.html'</span>]));
0602                 <span class="keyword">end</span>
0603             <span class="keyword">end</span>
0604         <span class="keyword">end</span>
0605     <span class="keyword">end</span>
0606 <span class="keyword">end</span>
0607 
0608 <span class="comment">%-------------------------------------------------------------------------------</span>
0609 <span class="comment">%- Search engine (index file and PHP script)</span>
0610 <span class="comment">%-------------------------------------------------------------------------------</span>
0611 tpl_search = <span class="string">'search.tpl'</span>;
0612 idx_search = <span class="string">'search.idx'</span>;
0613 
0614 <span class="comment">% TODO % improving the fill in of 'statlist' and 'statinfo'</span>
0615 <span class="comment">% TODO % improving the search template file and update the CSS file</span>
0616 
0617 <span class="keyword">if</span> options.search
0618     <span class="comment">%- Write the search index file in output directory</span>
0619     <span class="keyword">if</span> options.verbose
0620         fprintf(<span class="string">'Creating Search Index file %s...\n'</span>, idx_search);
0621     <span class="keyword">end</span>
0622     docinfo = cell(length(mfiles),2);
0623     <span class="keyword">for</span> i=1:length(mfiles)
0624         docinfo{i,1} = h1line{i};
0625         docinfo{i,2} = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{i}, [names{i} options.extension]);
0626     <span class="keyword">end</span>
0627     <a href="../../../CometsToolbox/external/m2html/private/doxywrite.html" class="code" title="function doxywrite(filename, kw, statinfo, docinfo)">doxywrite</a>(fullfile(options.htmlDir,idx_search),statlist,statinfo,docinfo);
0628     
0629     <span class="comment">%- Create the PHP template</span>
0630     tpl = <a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0631     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_SEARCH'</span>,tpl_search);
0632     
0633     <span class="comment">%- Open for writing the PHP search script</span>
0634     curfile = fullfile(options.htmlDir, php_search); 
0635     <span class="keyword">if</span> options.verbose
0636         fprintf(<span class="string">'Creating PHP script %s...\n'</span>,curfile);
0637     <span class="keyword">end</span>
0638     fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0639     
0640     <span class="comment">%- Set template fields</span>
0641     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0642     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<span class="string">'./'</span>);
0643     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0644                                 datestr(now,13)]);
0645     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'IDXFILE'</span>,idx_search);
0646     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0647     
0648     <span class="comment">%- Print the template in the HTML file</span>
0649     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_SEARCH'</span>);
0650     fprintf(fid,<span class="string">'%s'</span>,<a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0651     fclose(fid);
0652 <span class="keyword">end</span>
0653 
0654 <span class="comment">%-------------------------------------------------------------------------------</span>
0655 <span class="comment">%- Create &lt;helptoc.xml&gt; needed to display hierarchical entries in Contents panel</span>
0656 <span class="comment">%-------------------------------------------------------------------------------</span>
0657 <span class="comment">% See http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_env/guiref16.html</span>
0658 <span class="comment">% and http://www.mathworks.com/support/solutions/data/1-18U6Q.html?solution=1-18U6Q</span>
0659 
0660 <span class="comment">% TODO % display directories in TOC hierarchically instead of linearly</span>
0661 <span class="keyword">if</span> options.helptocxml
0662     curfile = fullfile(options.htmlDir, <span class="string">'helptoc.xml'</span>);
0663     <span class="keyword">if</span> options.verbose
0664         fprintf(<span class="string">'Creating XML Table-Of-Content %s...\n'</span>,curfile);
0665     <span class="keyword">end</span>
0666     fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0667     fprintf(fid,<span class="string">'&lt;?xml version=''1.0'' encoding=''ISO-8859-1'' ?&gt;\n'</span>);
0668     fprintf(fid,<span class="string">'&lt;!-- $Date: %s $ --&gt;\n\n'</span>, datestr(now,31));
0669     fprintf(fid,<span class="string">'&lt;toc version=&quot;1.0&quot;&gt;\n\n'</span>);
0670     fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0671         <span class="string">'image=&quot;$toolbox/matlab/icons/book_mat.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0672         [options.indexFile options.extension],<span class="string">'Toolbox'</span>);
0673     <span class="keyword">for</span> i=1:length(mdir)
0674         fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0675             <span class="string">'image=&quot;$toolbox/matlab/icons/reficon.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0676             fullfile(mdir{i}, <span class="keyword">...</span>
0677                 [options.indexFile options.extension]),mdir{i});
0678         <span class="keyword">if</span> options.graph
0679             fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0680             <span class="string">'image=&quot;$toolbox/matlab/icons/simulinkicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0681                 fullfile(mdir{i},<span class="keyword">...</span>
0682                 [dotbase options.extension]),<span class="string">'Dependency Graph'</span>);
0683         <span class="keyword">end</span>
0684         <span class="keyword">if</span> options.todo
0685             <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0686                 fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0687                 <span class="string">'image=&quot;$toolbox/matlab/icons/demoicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0688                     fullfile(mdir{i},<span class="keyword">...</span>
0689                     [<span class="string">'todo'</span> options.extension]),<span class="string">'Todo list'</span>);
0690             <span class="keyword">end</span>
0691         <span class="keyword">end</span>
0692         <span class="keyword">for</span> j=1:length(mdirs)
0693             <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0694                 curfile = fullfile(mdir{i},<span class="keyword">...</span>
0695                     [names{j} options.extension]);
0696                 fprintf(fid,<span class="string">'\t&lt;tocitem target=&quot;%s&quot;&gt;%s&lt;/tocitem&gt;\n'</span>, <span class="keyword">...</span>
0697                     curfile,names{j});
0698             <span class="keyword">end</span>
0699         <span class="keyword">end</span>
0700         fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0701     <span class="keyword">end</span>
0702     fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0703     fprintf(fid,<span class="string">'\n&lt;/toc&gt;\n'</span>);
0704     fclose(fid);
0705 <span class="keyword">end</span>
0706 
0707 <span class="comment">%-------------------------------------------------------------------------------</span>
0708 <span class="comment">%- Write an index for each output directory</span>
0709 <span class="comment">%-------------------------------------------------------------------------------</span>
0710 tpl_mdir = <span class="string">'mdir.tpl'</span>;
0711 tpl_mdir_link = <span class="string">'&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0712 <span class="comment">%dotbase defined earlier</span>
0713 
0714 <span class="comment">%- Create the HTML template</span>
0715 tpl = <a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0716 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MDIR'</span>,tpl_mdir);
0717 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'row-m'</span>,<span class="string">'rows-m'</span>);
0718 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'row-m'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0719 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'othermatlab'</span>,<span class="string">'other'</span>);
0720 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'othermatlab'</span>,<span class="string">'row-other'</span>,<span class="string">'rows-other'</span>);
0721 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'subfolder'</span>,<span class="string">'subfold'</span>);
0722 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'subfolder'</span>,<span class="string">'subdir'</span>,<span class="string">'subdirs'</span>);
0723 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'todolist'</span>,<span class="string">'todolists'</span>);
0724 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0725 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0726                             datestr(now,13)]);
0727 
0728 <span class="keyword">for</span> i=1:length(mdir)
0729     <span class="comment">%- Open for writing each output directory index file</span>
0730     curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0731                        [options.indexFile options.extension]);
0732     <span class="keyword">if</span> options.verbose
0733         fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0734     <span class="keyword">end</span>
0735     <span class="keyword">try</span>
0736     fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0737 
0738     <span class="comment">%- Set template fields</span>
0739     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,     [options.indexFile options.extension]);
0740     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0741     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,      mdir{i});
0742     
0743     <span class="comment">%- Display Matlab m-files, their H1 line and their Mex status</span>
0744     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'rows-m'</span>,<span class="string">''</span>);
0745     <span class="keyword">for</span> j=1:length(mdirs)
0746         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0747             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME'</span>, [names{j} options.extension]);
0748             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,   names{j});
0749             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>, h1line{j});
0750             <span class="keyword">if</span> any(ismex(j,:))
0751                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
0752             <span class="keyword">else</span>
0753                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>,<span class="string">''</span>);
0754             <span class="keyword">end</span>
0755             tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rows-m'</span>,<span class="string">'row-m'</span>,1);
0756         <span class="keyword">end</span>
0757     <span class="keyword">end</span>
0758     
0759     <span class="comment">%- Display other Matlab-specific files (.mat,.mdl,.p)</span>
0760     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'other'</span>,<span class="string">''</span>);
0761     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'rows-other'</span>,<span class="string">''</span>);
0762     w = what(mdir{i}); w = w(1);
0763     w = {w.mat{:} w.mdl{:} w.p{:}};
0764     <span class="keyword">for</span> j=1:length(w)
0765         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'OTHERFILE'</span>,w{j});
0766         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rows-other'</span>,<span class="string">'row-other'</span>,1);
0767     <span class="keyword">end</span>
0768     <span class="keyword">if</span> ~isempty(w)
0769         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'other'</span>,<span class="string">'othermatlab'</span>);
0770     <span class="keyword">end</span>
0771     
0772     <span class="comment">%- Display subsequent directories and classes</span>
0773     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'subdirs'</span>,<span class="string">''</span>);
0774     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'subfold'</span>,<span class="string">''</span>);
0775     d = dir(mdir{i});
0776     d = {d([d.isdir]).name};
0777     d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> options.ignoredDir{:}})}};
0778     <span class="keyword">for</span> j=1:length(d)
0779         <span class="keyword">if</span> ismember(fullfile(mdir{i},d{j}),mdir)
0780             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,<span class="keyword">...</span>
0781                 sprintf(tpl_mdir_link,<span class="keyword">...</span>
0782                 <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(d{j},[options.indexFile options.extension]),d{j}));
0783         <span class="keyword">else</span>
0784             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,d{j});
0785         <span class="keyword">end</span>
0786         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'subdirs'</span>,<span class="string">'subdir'</span>,1);
0787     <span class="keyword">end</span>
0788     <span class="keyword">if</span> ~isempty(d)
0789         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'subfold'</span>,<span class="string">'subfolder'</span>);
0790     <span class="keyword">end</span>
0791     
0792     <span class="comment">%- Link to the TODO list if necessary</span>
0793     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'todolists'</span>,<span class="string">''</span>);
0794     <span class="keyword">if</span> options.todo
0795         <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0796             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LTODOLIST'</span>,[<span class="string">'todo'</span> options.extension]);
0797             tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'todolists'</span>,<span class="string">'todolist'</span>,1);
0798         <span class="keyword">end</span>
0799     <span class="keyword">end</span>
0800     
0801     <span class="comment">%- Link to the dependency graph if necessary</span>
0802     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0803     <span class="keyword">if</span> options.graph
0804         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0805         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0806     <span class="keyword">end</span>
0807     
0808     <span class="comment">%- Print the template in the HTML file</span>
0809     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MDIR'</span>);
0810     fprintf(fid,<span class="string">'%s'</span>,<a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0811     fclose(fid);
0812     <span class="keyword">catch</span> ME
0813     <span class="keyword">end</span>
0814 <span class="keyword">end</span>
0815 
0816 <span class="comment">%-------------------------------------------------------------------------------</span>
0817 <span class="comment">%- Write a TODO list file for each output directory, if necessary</span>
0818 <span class="comment">%-------------------------------------------------------------------------------</span>
0819 tpl_todo = <span class="string">'todo.tpl'</span>;
0820 
0821 <span class="keyword">if</span> options.todo
0822     <span class="comment">%- Create the HTML template</span>
0823     tpl = <a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0824     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_TODO'</span>,tpl_todo);
0825     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_TODO'</span>,<span class="string">'filelist'</span>,<span class="string">'filelists'</span>);
0826     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'filelist'</span>,<span class="string">'row'</span>,<span class="string">'rows'</span>);
0827     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0828                                 datestr(now,13)]);
0829 
0830     <span class="keyword">for</span> i=1:length(mdir)
0831         mfilestodo = intersect(find(strcmp(mdir{i},mdirs)),todo.mfile);
0832         <span class="keyword">if</span> ~isempty(mfilestodo)
0833             <span class="comment">%- Open for writing each TODO list file</span>
0834             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0835                                [<span class="string">'todo'</span> options.extension]);
0836             <span class="keyword">if</span> options.verbose
0837                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0838             <span class="keyword">end</span>
0839             fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0840             
0841             <span class="comment">%- Set template fields</span>
0842             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0843             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0844             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0845             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'filelists'</span>,  <span class="string">''</span>);
0846     
0847             <span class="keyword">for</span> k=1:length(mfilestodo)
0848                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MFILE'</span>,names{mfilestodo(k)});
0849                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'rows'</span>,<span class="string">''</span>);
0850                 nbtodo = find(todo.mfile == mfilestodo(k));
0851                 <span class="keyword">for</span> l=1:length(nbtodo)
0852                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NBLINE'</span>,<span class="keyword">...</span>
0853                         [names{mfilestodo(k)} <span class="keyword">...</span>
0854                             options.extension <span class="keyword">...</span>
0855                             <span class="string">'#l'</span> num2str(todo.line(nbtodo(l)))]);
0856                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NBLINE'</span>,num2str(todo.line(nbtodo(l))));
0857                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'COMMENT'</span>,todo.comment{nbtodo(l)});
0858                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rows'</span>,<span class="string">'row'</span>,1);
0859                 <span class="keyword">end</span>
0860                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'filelists'</span>,<span class="string">'filelist'</span>,1);
0861             <span class="keyword">end</span>
0862     
0863             <span class="comment">%- Print the template in the HTML file</span>
0864             tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_TODO'</span>);
0865             fprintf(fid,<span class="string">'%s'</span>,<a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0866             fclose(fid);
0867         <span class="keyword">end</span>
0868     <span class="keyword">end</span>
0869 <span class="keyword">end</span>
0870 
0871 <span class="comment">%-------------------------------------------------------------------------------</span>
0872 <span class="comment">%- Create dependency graphs using GraphViz, if requested</span>
0873 <span class="comment">%-------------------------------------------------------------------------------</span>
0874 tpl_graph = <span class="string">'graph.tpl'</span>;
0875 <span class="comment">% You may have to modify the following line with Matlab7 (R14) to specify</span>
0876 <span class="comment">% the full path to where GraphViz is installed</span>
0877 dot_exec  = <span class="string">'dot'</span>;
0878 <span class="comment">%dotbase defined earlier</span>
0879 
0880 <span class="keyword">if</span> options.graph
0881     <span class="comment">%- Create the HTML template</span>
0882     tpl = <a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0883     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_GRAPH'</span>,tpl_graph);
0884     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0885                                 datestr(now,13)]);
0886     
0887     <span class="comment">%- Create a full dependency graph for all directories if possible</span>
0888     <span class="keyword">if</span> options.globalHypertextLinks &amp; length(mdir) &gt; 1
0889         mdotfile = fullfile(options.htmlDir,[dotbase <span class="string">'.dot'</span>]);
0890         <span class="keyword">if</span> options.verbose
0891             fprintf(<span class="string">'Creating full dependency graph %s...'</span>,mdotfile);
0892         <span class="keyword">end</span>
0893         <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({hrefs, names, options, mdirs}, mdotfile); <span class="comment">%mfiles</span>
0894         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0895                 fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0896                 fullfile(options.htmlDir,[dotbase <span class="string">'.png'</span>]));
0897         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0898         fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir, [dotbase options.extension]),<span class="string">'w'</span>);
0899         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0900         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0901         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       <span class="string">'the whole toolbox'</span>);
0902         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0903         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed...</span>
0904             fmap = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0905             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0906             fclose(fmap);
0907         <span class="keyword">end</span>
0908         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0909         fprintf(fid,<span class="string">'%s'</span>, <a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0910         fclose(fid);
0911     <span class="keyword">end</span>
0912     
0913     <span class="comment">%- Create a dependency graph for each output directory</span>
0914     <span class="keyword">for</span> i=1:length(mdir)
0915         mdotfile = fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.dot'</span>]);
0916         <span class="keyword">if</span> options.verbose
0917             fprintf(<span class="string">'Creating dependency graph %s...'</span>,mdotfile);
0918         <span class="keyword">end</span>
0919         ind = find(strcmp(mdirs,mdir{i}));
0920         href1 = zeros(length(ind),length(hrefs));
0921         <span class="keyword">for</span> j=1:length(hrefs), href1(:,j) = hrefs(ind,j); <span class="keyword">end</span>
0922         href2 = zeros(length(ind));
0923         <span class="keyword">for</span> j=1:length(ind), href2(j,:) = href1(j,ind); <span class="keyword">end</span>
0924         <a href="mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({href2, {names{ind}}, options}, mdotfile); <span class="comment">%{mfiles{ind}}</span>
0925         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0926                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0927                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.png'</span>]));
0928         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0929         fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0930             [dotbase options.extension]),<span class="string">'w'</span>);
0931         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0932         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0933         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0934         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0935         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed, no '.map' file has been created</span>
0936             fmap = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0937             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0938             fclose(fmap);
0939         <span class="keyword">end</span>
0940         tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0941         fprintf(fid,<span class="string">'%s'</span>, <a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0942         fclose(fid);
0943     <span class="keyword">end</span>
0944 <span class="keyword">end</span>
0945 
0946 <span class="comment">%-------------------------------------------------------------------------------</span>
0947 <span class="comment">%- Write an HTML file for each M-file</span>
0948 <span class="comment">%-------------------------------------------------------------------------------</span>
0949 <span class="comment">%- List of Matlab keywords (output from iskeyword)</span>
0950 matlabKeywords = {<span class="string">'break'</span>, <span class="string">'case'</span>, <span class="string">'catch'</span>, <span class="string">'continue'</span>, <span class="string">'elseif'</span>, <span class="string">'else'</span>, <span class="keyword">...</span>
0951                   <span class="string">'end'</span>, <span class="string">'for'</span>, <span class="string">'function'</span>, <span class="string">'global'</span>, <span class="string">'if'</span>, <span class="string">'otherwise'</span>, <span class="keyword">...</span>
0952                   <span class="string">'persistent'</span>, <span class="string">'return'</span>, <span class="string">'switch'</span>, <span class="string">'try'</span>, <span class="string">'while'</span>};
0953                   <span class="comment">%'keyboard', 'pause', 'eps', 'NaN', 'Inf'</span>
0954 
0955 tpl_mfile = <span class="string">'mfile.tpl'</span>;
0956 
0957 tpl_mfile_code     = <span class="string">'&lt;a href=&quot;%s&quot; class=&quot;code&quot; title=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0958 tpl_mfile_keyword  = <span class="string">'&lt;span class=&quot;keyword&quot;&gt;%s&lt;/span&gt;'</span>;
0959 tpl_mfile_comment  = <span class="string">'&lt;span class=&quot;comment&quot;&gt;%s&lt;/span&gt;'</span>;
0960 tpl_mfile_string   = <span class="string">'&lt;span class=&quot;string&quot;&gt;%s&lt;/span&gt;'</span>;
0961 tpl_mfile_aname    = <span class="string">'&lt;a name=&quot;%s&quot; href=&quot;#_subfunctions&quot; class=&quot;code&quot;&gt;%s&lt;/a&gt;'</span>;
0962 tpl_mfile_line     = <span class="string">'%04d %s\n'</span>;
0963 
0964 <span class="comment">%- Delimiters used in strtok: some of them may be useless (% &quot; .), removed '.'</span>
0965 strtok_delim = sprintf(<span class="string">' \t\n\r(){}[]&lt;&gt;+-*~!|\\@&amp;/,:;=&quot;''%%'</span>);
0966 
0967 <span class="comment">%- Create the HTML template</span>
0968 tpl = <a href="../../../CometsToolbox/external/m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0969 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MFILE'</span>,tpl_mfile);
0970 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'pathline'</span>,<span class="string">'pl'</span>);
0971 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0972 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'script'</span>,<span class="string">'scriptfile'</span>);
0973 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcall'</span>,<span class="string">'crossrefcalls'</span>);
0974 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcalled'</span>,<span class="string">'crossrefcalleds'</span>);
0975 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'subfunction'</span>,<span class="string">'subf'</span>);
0976 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'subfunction'</span>,<span class="string">'onesubfunction'</span>,<span class="string">'onesubf'</span>);
0977 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'source'</span>,<span class="string">'thesource'</span>);
0978 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'download'</span>,<span class="string">'downloads'</span>);
0979 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0980                             datestr(now,13)]);
0981 
0982 nblinetot = 0;
0983 <span class="keyword">for</span> i=1:length(mdir)
0984     <span class="keyword">for</span> j=1:length(mdirs)
0985         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0986         
0987             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0988                                [names{j} options.extension]);
0989                                
0990             <span class="comment">%- Copy M-file for download, if necessary</span>
0991             <span class="keyword">if</span> options.download
0992                 <span class="keyword">if</span> options.verbose
0993                     fprintf(<span class="string">'Copying M-file %s.m to %s...\n'</span>,names{j},<span class="keyword">...</span>
0994                         fullfile(options.htmlDir,mdir{i}));
0995                 <span class="keyword">end</span>
0996                 [status, errmsg] = copyfile(mfiles{j},<span class="keyword">...</span>
0997                     fullfile(options.htmlDir,mdir{i}));
0998                 error(errmsg);
0999             <span class="keyword">end</span>
1000             
1001             <span class="comment">%- Open for writing the HTML file</span>
1002             <span class="keyword">if</span> options.verbose
1003                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
1004             <span class="keyword">end</span>
1005             <span class="keyword">try</span>
1006             fid = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
1007             <span class="keyword">if</span> strcmp(names{j},options.indexFile)
1008                 fprintf([<span class="string">'Warning: HTML index file %s will be '</span> <span class="keyword">...</span>
1009                         <span class="string">'overwritten by Matlab function %s.\n'</span>], <span class="keyword">...</span>
1010                         [options.indexFile options.extension], mfiles{j});
1011             <span class="keyword">end</span>
1012             
1013             <span class="comment">%- Open for reading the M-file</span>
1014             fid2 = <a href="../../../CometsToolbox/external/m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(mfiles{j},<span class="string">'r'</span>);
1015             
1016             <span class="comment">%- Set some template fields</span>
1017             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>, [options.indexFile options.extension]);
1018             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,       <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
1019             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,             mdirs{j});
1020             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,             names{j});
1021             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>,           <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(h1line{j}));
1022             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'scriptfile'</span>,       <span class="string">''</span>);
1023             <span class="keyword">if</span> isempty(synopsis{j})
1024                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>,<a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'var'</span>,<span class="string">'script'</span>));
1025             <span class="keyword">else</span>
1026                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>, synopsis{j});
1027             <span class="keyword">end</span>
1028             s = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
1029             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'pl'</span>,<span class="string">''</span>);
1030             <span class="keyword">for</span> k=1:length(s)
1031                 c = cell(1,k); <span class="keyword">for</span> l=1:k, c{l} = filesep; <span class="keyword">end</span>
1032                 cpath = {s{1:k};c{:}}; cpath = [cpath{:}];
1033                 <span class="keyword">if</span> ~isempty(cpath), cpath = cpath(1:end-1); <span class="keyword">end</span>
1034                 <span class="keyword">if</span> ismember(cpath,mdir)
1035                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,[repmat(<span class="string">'../'</span>,<span class="keyword">...</span>
1036                         1,length(s)-k) options.indexFile options.extension]);
1037                 <span class="keyword">else</span>
1038                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,<span class="string">'#'</span>);
1039                 <span class="keyword">end</span>
1040                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PATHDIR'</span>,s{k});
1041                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'pl'</span>,<span class="string">'pathline'</span>,1);
1042             <span class="keyword">end</span>
1043             
1044             <span class="comment">%- Handle mex files</span>
1045             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>, <span class="string">''</span>);
1046             samename = dir(fullfile(mdir{i},[names{j}    <span class="string">'.*'</span>]));
1047             samename = {samename.name};
1048             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'mex'</span>);
1049             <span class="keyword">for</span> k=1:length(samename)
1050                 [dummy, dummy, ext] = fileparts(samename{k});
1051                 <span class="keyword">switch</span> ext
1052                     <span class="keyword">case</span> <span class="string">'.c'</span>
1053                         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c'</span>);
1054                     <span class="keyword">case</span> {<span class="string">'.cpp'</span> <span class="string">'.c++'</span> <span class="string">'.cxx'</span> <span class="string">'.C'</span>}
1055                         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c++'</span>);
1056                     <span class="keyword">case</span> {<span class="string">'.for'</span> <span class="string">'.f'</span> <span class="string">'.FOR'</span> <span class="string">'.F'</span>}
1057                         tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'fortran'</span>);
1058                     <span class="keyword">otherwise</span>
1059                         <span class="comment">%- Unknown mex file source</span>
1060                 <span class="keyword">end</span>
1061             <span class="keyword">end</span>
1062             [exts, platform] = <a href="../../../CometsToolbox/external/m2html/private/mexexts.html" class="code" title="function [ext, platform] = mexexts">mexexts</a>;
1063             mexplatforms = sprintf(<span class="string">'%s, '</span>,platform{find(ismex(j,:))});
1064             <span class="keyword">if</span> ~isempty(mexplatforms)
1065                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PLATFORMS'</span>, mexplatforms(1:end-2));
1066                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
1067             <span class="keyword">end</span>
1068             
1069             <span class="comment">%- Set description template field</span>
1070             descr = <span class="string">''</span>;
1071             flagsynopcont = 0;
1072             flag_seealso  = 0;
1073             <span class="keyword">while</span> 1
1074                 tline = fgets(fid2);
1075                 <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1076                 tline = <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(fliplr(deblank(fliplr(tline))));
1077                 <span class="comment">%- Synopsis line</span>
1078                 <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'function'</span>,tline))
1079                     <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1080                         flagsynopcont = 1;
1081                     <span class="keyword">end</span>
1082                 <span class="comment">%- H1 line and description</span>
1083                 <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'%'</span>,tline))
1084                     <span class="comment">%- Hypertext links on the &quot;See also&quot; line</span>
1085                     ind = findstr(lower(tline),<span class="string">'see also'</span>);
1086                     <span class="keyword">if</span> ~isempty(ind) | flag_seealso
1087                         <span class="comment">%- &quot;See also&quot; only in files in the same directory</span>
1088                         indsamedir = find(strcmp(mdirs{j},mdirs));
1089                         hrefnames = {names{indsamedir}};
1090                         r = deblank(tline);
1091                         flag_seealso = 1; <span class="comment">%(r(end) == ',');</span>
1092                         tline = <span class="string">''</span>;
1093                         <span class="keyword">while</span> 1
1094                             [t,r,q] = <a href="../../../CometsToolbox/external/m2html/private/strtok.html" class="code" title="function [token, remainder, quotient] = strtok(string, delimiters)">strtok</a>(r,sprintf(<span class="string">' \t\n\r.,;%%'</span>));
1095                             tline = [tline q];
1096                             <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>;
1097                             ii = strcmpi(hrefnames,t);
1098                             <span class="keyword">if</span> any(ii)
1099                                 jj = find(ii);
1100                                 tline = [tline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1101                                     [hrefnames{jj(1)} options.extension],<span class="keyword">...</span>
1102                                     synopsis{indsamedir(jj(1))},t)];
1103                             <span class="keyword">else</span>
1104                                 tline = [tline t];
1105                             <span class="keyword">end</span>
1106                         <span class="keyword">end</span>
1107                         tline = sprintf(<span class="string">'%s\n'</span>,tline);
1108                     <span class="keyword">end</span>
1109                     descr = [descr tline(2:end)];
1110                 <span class="keyword">elseif</span> isempty(tline)
1111                     <span class="keyword">if</span> ~isempty(descr), <span class="keyword">break</span>, <span class="keyword">end</span>;
1112                 <span class="keyword">else</span>
1113                     <span class="keyword">if</span> flagsynopcont
1114                         <span class="keyword">if</span> isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1115                             flagsynopcont = 0;
1116                         <span class="keyword">end</span>
1117                     <span class="keyword">else</span>
1118                         <span class="keyword">break</span>;
1119                     <span class="keyword">end</span>
1120                 <span class="keyword">end</span>
1121             <span class="keyword">end</span>
1122             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DESCRIPTION'</span>,<span class="keyword">...</span>
1123                 <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(descr,options.tabs));
1124             
1125             <span class="comment">%- Set cross-references template fields:</span>
1126             <span class="comment">%  Function called</span>
1127             ind = find(hrefs(j,:) == 1);
1128             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalls'</span>,<span class="string">''</span>);
1129             <span class="keyword">for</span> k=1:length(ind)
1130                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1131                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1132                         [names{ind(k)} options.extension]);
1133                 <span class="keyword">else</span>
1134                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1135                               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}), <span class="keyword">...</span>
1136                                          mdirs{ind(k)}, <span class="keyword">...</span>
1137                                        [names{ind(k)} options.extension]));
1138                 <span class="keyword">end</span>
1139                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALL'</span>,   synopsis{ind(k)});
1140                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALL'</span>,   names{ind(k)});
1141                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALL'</span>, h1line{ind(k)});
1142                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'crossrefcalls'</span>,<span class="string">'crossrefcall'</span>,1);
1143             <span class="keyword">end</span>
1144             <span class="comment">%  Callers</span>
1145             ind = find(hrefs(:,j) == 1);
1146             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalleds'</span>,<span class="string">''</span>);
1147             <span class="keyword">for</span> k=1:length(ind)
1148                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1149                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1150                         [names{ind(k)} options.extension]);
1151                 <span class="keyword">else</span>
1152                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1153                         <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1154                             mdirs{ind(k)}, <span class="keyword">...</span>
1155                             [names{ind(k)} options.extension]));
1156                 <span class="keyword">end</span>
1157                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALLED'</span>,   synopsis{ind(k)});
1158                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALLED'</span>,   names{ind(k)});
1159                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALLED'</span>, h1line{ind(k)});
1160                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'crossrefcalleds'</span>,<span class="string">'crossrefcalled'</span>,1);
1161             <span class="keyword">end</span>
1162             
1163             <span class="comment">%- Set subfunction template field</span>
1164             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,{<span class="string">'subf'</span> <span class="string">'onesubf'</span>},{<span class="string">''</span> <span class="string">''</span>});
1165             <span class="keyword">if</span> ~isempty(subroutine{j}) &amp; options.source
1166                 <span class="keyword">for</span> k=1:length(subroutine{j})
1167                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl, <span class="string">'var'</span>, <span class="string">'L_SUB'</span>, [<span class="string">'#_sub'</span> num2str(k)]);
1168                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl, <span class="string">'var'</span>, <span class="string">'SUB'</span>,   subroutine{j}{k});
1169                     tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl, <span class="string">'onesubf'</span>, <span class="string">'onesubfunction'</span>,1);
1170                 <span class="keyword">end</span>
1171                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'subf'</span>,<span class="string">'subfunction'</span>);
1172             <span class="keyword">end</span>
1173             subname = <a href="#_sub5" class="code" title="subfunction name = extractname(synopsis)">extractname</a>(subroutine{j});
1174             
1175             <span class="comment">%- Link to M-file (for download)</span>
1176             tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'downloads'</span>,<span class="string">''</span>);
1177             <span class="keyword">if</span> options.download
1178                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'downloads'</span>,<span class="string">'download'</span>,1);
1179             <span class="keyword">end</span>
1180             
1181             <span class="comment">%- Display source code with cross-references</span>
1182             <span class="keyword">if</span> options.source &amp; ~strcmpi(names{j},<span class="string">'contents'</span>)
1183                 fseek(fid2,0,-1);
1184                 it = 1;
1185                 matlabsource = <span class="string">''</span>;
1186                 nbsubroutine = 1;
1187                 <span class="comment">%- Get href function names of this file</span>
1188                 indhrefnames = find(hrefs(j,:) == 1);
1189                 hrefnames = {names{indhrefnames}};
1190                 <span class="comment">%- Loop over lines</span>
1191                 <span class="keyword">while</span> 1
1192                     tline = fgetl(fid2);
1193                     <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1194                     myline = <span class="string">''</span>;
1195                     splitc = <a href="../../../CometsToolbox/external/m2html/private/splitcode.html" class="code" title="function splitc = splitcode(code)">splitcode</a>(<a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(tline));
1196                     <span class="keyword">for</span> k=1:length(splitc)
1197                         <span class="keyword">if</span> isempty(splitc{k})
1198                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'function'</span>, <span class="keyword">...</span>
1199                                         fliplr(deblank(fliplr(splitc{k})))))
1200                             <span class="keyword">if</span> isspace(splitc{k}(1))
1201                                 nbs = find(diff(isspace(splitc{k}))==-1);
1202                                 myline = [myline splitc{k}(1:nbs(1))];
1203                                 splitc{k} = splitc{k}(nbs(1)+1:end);
1204                             <span class="keyword">end</span>
1205                             <span class="comment">%- Subfunctions definition</span>
1206                             myline = [myline <span class="keyword">...</span>
1207                                 sprintf(tpl_mfile_aname,<span class="keyword">...</span>
1208                                     [<span class="string">'_sub'</span> num2str(nbsubroutine-1)],splitc{k})];
1209                             nbsubroutine = nbsubroutine + 1;
1210                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">''''</span>
1211                             myline = [myline <span class="keyword">...</span>
1212                                 sprintf(tpl_mfile_string,splitc{k})];
1213                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">'%'</span>
1214                             myline = [myline <span class="keyword">...</span>
1215                                 sprintf(tpl_mfile_comment,deblank(splitc{k}))];
1216                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'...'</span>,splitc{k}))
1217                             myline = [myline sprintf(tpl_mfile_keyword,<span class="string">'...'</span>)];
1218                             <span class="keyword">if</span> ~isempty(splitc{k}(4:end))
1219                                 myline = [myline <span class="keyword">...</span>
1220                                     sprintf(tpl_mfile_comment,splitc{k}(4:end))];
1221                             <span class="keyword">end</span>
1222                         <span class="keyword">else</span>
1223                             <span class="comment">%- Look for keywords</span>
1224                             r = splitc{k};
1225                             <span class="keyword">while</span> 1
1226                                 [t,r,q] = <a href="../../../CometsToolbox/external/m2html/private/strtok.html" class="code" title="function [token, remainder, quotient] = strtok(string, delimiters)">strtok</a>(r,strtok_delim);
1227                                 myline = [myline q];
1228                                 <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>;
1229                                 <span class="comment">%- Highlight Matlab keywords &amp;</span>
1230                                 <span class="comment">%  cross-references on known functions</span>
1231                                 <span class="keyword">if</span> options.syntaxHighlighting &amp; <span class="keyword">...</span>
1232                                         any(strcmp(matlabKeywords,t))
1233                                     <span class="keyword">if</span> strcmp(<span class="string">'end'</span>,t)
1234                                         rr = fliplr(deblank(fliplr(r)));
1235                                         icomma = strmatch(<span class="string">','</span>,rr);
1236                                         isemicolon = strmatch(<span class="string">';'</span>,rr);
1237                                         <span class="keyword">if</span> ~(isempty(rr) | ~isempty([icomma isemicolon]))
1238                                             myline = [myline t];
1239                                         <span class="keyword">else</span>
1240                                             myline = [myline sprintf(tpl_mfile_keyword,t)];
1241                                         <span class="keyword">end</span>
1242                                     <span class="keyword">else</span>
1243                                         myline = [myline sprintf(tpl_mfile_keyword,t)];
1244                                     <span class="keyword">end</span>
1245                                 <span class="keyword">elseif</span> any(strcmp(hrefnames,t))
1246                                     indt = indhrefnames(logical(strcmp(hrefnames,t)));
1247                                     flink = [t options.extension];
1248                                     ii = ismember({mdirs{indt}},mdirs{j});
1249                                     <span class="keyword">if</span> ~any(ii)
1250                                         <span class="comment">% take the first one...</span>
1251                                         flink = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1252                                                           mdirs{indt(1)}, flink);
1253                                     <span class="keyword">else</span>
1254                                         indt = indt(logical(ii));
1255                                     <span class="keyword">end</span>
1256                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1257                                               flink, synopsis{indt(1)}, t)];
1258                                 <span class="keyword">elseif</span> any(strcmp(subname,t))
1259                                     ii = find(strcmp(subname,t));
1260                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1261                                         [<span class="string">'#_sub'</span> num2str(ii)],<span class="keyword">...</span>
1262                                         [<span class="string">'sub'</span> subroutine{j}{ii}],t)];
1263                                 <span class="keyword">else</span>
1264                                     myline = [myline t];
1265                                 <span class="keyword">end</span>
1266                             <span class="keyword">end</span>
1267                         <span class="keyword">end</span>
1268                     <span class="keyword">end</span>
1269                     matlabsource = [matlabsource sprintf(tpl_mfile_line,it,myline)];
1270                     it = it + 1;
1271                 <span class="keyword">end</span>
1272                 nblinetot = nblinetot + it - 1;
1273                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SOURCECODE'</span>,<span class="keyword">...</span>
1274                           <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(matlabsource,options.tabs));
1275                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'thesource'</span>,<span class="string">'source'</span>);
1276             <span class="keyword">else</span>
1277                 tpl = <a href="../../../CometsToolbox/external/m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'thesource'</span>,<span class="string">''</span>);
1278             <span class="keyword">end</span>
1279             tpl = <a href="../../../CometsToolbox/external/m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MFILE'</span>);
1280             fprintf(fid,<span class="string">'%s'</span>,<a href="../../../CometsToolbox/external/m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
1281             fclose(fid2);
1282             fclose(fid);
1283             <span class="keyword">catch</span> ME
1284             <span class="keyword">end</span>
1285         <span class="keyword">end</span>
1286     <span class="keyword">end</span>
1287 <span class="keyword">end</span>
1288 
1289 <span class="comment">%-------------------------------------------------------------------------------</span>
1290 <span class="comment">%- Display Statistics</span>
1291 <span class="comment">%-------------------------------------------------------------------------------</span>
1292 <span class="keyword">if</span> options.verbose
1293     prnbline = <span class="string">''</span>;
1294     <span class="keyword">if</span> options.source
1295         prnbline = sprintf(<span class="string">'(%d lines) '</span>, nblinetot);
1296     <span class="keyword">end</span>
1297     fprintf(<span class="string">'Stats: %d M-files %sin %d directories documented in %d s.\n'</span>, <span class="keyword">...</span>
1298             length(mfiles), prnbline, length(mdir), round(etime(clock,t0)));
1299 <span class="keyword">end</span>
1300 
1301 <span class="comment">%===============================================================================</span>
1302 <a name="_sub1" href="#_subfunctions" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)</a>
1303     <span class="comment">%- Extract M-files from a list of directories and/or M-files</span>
1304 
1305     <span class="keyword">if</span> nargin &lt; 4, ignoredDir = {}; <span class="keyword">end</span>
1306     <span class="keyword">for</span> i=1:length(mdirs)
1307         currentdir = fullfile(pwd, mdirs{i});
1308         <span class="keyword">if</span> exist(currentdir) == 2 <span class="comment">% M-file</span>
1309             mfiles{end+1} = mdirs{i};
1310         <span class="keyword">elseif</span> exist(currentdir) == 7 <span class="comment">% Directory</span>
1311             d = dir(fullfile(currentdir, <span class="string">'*.m'</span>));
1312             d = {d(~[d.isdir]).name};
1313             <span class="keyword">for</span> j=1:length(d)
1314                 <span class="comment">%- don't take care of files containing ','</span>
1315                 <span class="comment">%  probably a sccs file...</span>
1316                 <span class="keyword">if</span> isempty(findstr(<span class="string">','</span>,d{j}))
1317                     mfiles{end+1} = fullfile(mdirs{i}, d{j});
1318                 <span class="keyword">end</span>
1319             <span class="keyword">end</span>
1320             <span class="keyword">if</span> recursive
1321                 d = dir(currentdir);
1322                 d = {d([d.isdir]).name};
1323                 d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> ignoredDir{:}})}};
1324                 <span class="keyword">for</span> j=1:length(d)
1325                     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive, ignoredDir)">getmfiles</a>(cellstr(fullfile(mdirs{i},d{j})), <span class="keyword">...</span>
1326                                        mfiles, recursive, ignoredDir);
1327                 <span class="keyword">end</span>
1328             <span class="keyword">end</span>
1329         <span class="keyword">else</span>
1330             fprintf(<span class="string">'Warning: Unprocessed file %s.\n'</span>,mdirs{i});
1331             <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'/'</span>,mdirs{i})) | findstr(<span class="string">':'</span>,mdirs{i})
1332                 fprintf(<span class="string">'         Use relative paths in ''mfiles'' option\n'</span>);
1333             <span class="keyword">end</span> 
1334         <span class="keyword">end</span>
1335     <span class="keyword">end</span>
1336 
1337 <span class="comment">%===============================================================================</span>
1338 <a name="_sub2" href="#_subfunctions" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a>
1339     <span class="comment">%- Draw a dependency graph in a PNG image using &lt;dot&gt; from GraphViz</span>
1340 
1341     <span class="keyword">if</span> nargin == 4, opt = <span class="string">''</span>; <span class="keyword">end</span>
1342     <span class="keyword">try</span>
1343         <span class="comment">%- See &lt;http://www.graphviz.org/&gt;</span>
1344         <span class="comment">%  &lt;dot&gt; must be in your system path, see M2HTML FAQ:</span>
1345         <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/faq.php&gt;</span>
1346 
1347         eval([<span class="string">'!&quot;'</span> dotexec <span class="string">'&quot; '</span> opt <span class="string">' -Tcmap -Tpng &quot;'</span> mdotfile <span class="keyword">...</span>
1348               <span class="string">'&quot; -o &quot;'</span> mapfile <span class="keyword">...</span><span class="comment"> </span>
1349               <span class="string">'&quot; -o &quot;'</span> pngfile <span class="string">'&quot;'</span>]);
1350         <span class="comment">% use '!' rather than 'system' for backward compability with Matlab 5.3</span>
1351     <span class="keyword">catch</span> <span class="comment">% use of '!' prevents errors to be catched...</span>
1352         fprintf(<span class="string">'&lt;dot&gt; failed.'</span>);
1353     <span class="keyword">end</span>
1354     
1355 <span class="comment">%===============================================================================</span>
1356 <a name="_sub3" href="#_subfunctions" class="code">function s = backtomaster(mdir)</a>
1357     <span class="comment">%- Provide filesystem path to go back to the root folder</span>
1358 
1359     ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir);
1360     s = repmat(<span class="string">'../'</span>,1,length(ldir));
1361     
1362 <span class="comment">%===============================================================================</span>
1363 <a name="_sub4" href="#_subfunctions" class="code">function ldir = splitpath(p)</a>
1364     <span class="comment">%- Split a filesystem path into parts using filesep as separator</span>
1365 
1366     ldir = {};
1367     p = deblank(p);
1368     <span class="keyword">while</span> 1
1369         [t,p] = <a href="../../../CometsToolbox/external/m2html/private/strtok.html" class="code" title="function [token, remainder, quotient] = strtok(string, delimiters)">strtok</a>(p,filesep);
1370         <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>; <span class="keyword">end</span>
1371         <span class="keyword">if</span> ~strcmp(t,<span class="string">'.'</span>)
1372             ldir{end+1} = t;
1373         <span class="keyword">end</span>
1374     <span class="keyword">end</span>
1375     <span class="keyword">if</span> isempty(ldir)
1376         ldir{1} = <span class="string">'.'</span>; <span class="comment">% should be removed</span>
1377     <span class="keyword">end</span>
1378 
1379 <span class="comment">%===============================================================================</span>
1380 <a name="_sub5" href="#_subfunctions" class="code">function name = extractname(synopsis)</a>
1381     <span class="comment">%- Extract function name in a synopsis</span>
1382 
1383     <span class="keyword">if</span> ischar(synopsis), synopsis = {synopsis}; <span class="keyword">end</span>
1384     name = cell(size(synopsis));
1385     <span class="keyword">for</span> i=1:length(synopsis)
1386         ind = findstr(synopsis{i},<span class="string">'='</span>);
1387         <span class="keyword">if</span> isempty(ind)
1388             ind = findstr(synopsis{i},<span class="string">'function'</span>);
1389             s = synopsis{i}(ind(1)+8:end);
1390         <span class="keyword">else</span>
1391             s = synopsis{i}(ind(1)+1:end);
1392         <span class="keyword">end</span>
1393         name{i} = <a href="../../../CometsToolbox/external/m2html/private/strtok.html" class="code" title="function [token, remainder, quotient] = strtok(string, delimiters)">strtok</a>(s,[9:13 32 40]); <span class="comment">% white space characters and '('</span>
1394     <span class="keyword">end</span>
1395     <span class="keyword">if</span> length(name) == 1, name = name{1}; <span class="keyword">end</span>
1396 
1397 <span class="comment">%===============================================================================</span>
1398 <a name="_sub6" href="#_subfunctions" class="code">function f = fullurl(varargin)</a>
1399     <span class="comment">%- Build full url from parts (using '/' and not filesep)</span>
1400     
1401     f = strrep(fullfile(varargin{:}),<span class="string">'\'</span>,<span class="string">'/'</span>);
1402 
1403 <span class="comment">%===============================================================================</span>
1404 <a name="_sub7" href="#_subfunctions" class="code">function str = escapeblank(str)</a>
1405     <span class="comment">%- Escape white spaces using '\'</span>
1406     
1407     str = deblank(fliplr(deblank(fliplr(str))));
1408     str = strrep(str,<span class="string">' '</span>,<span class="string">'\ '</span>);
1409 
1410 <span class="comment">%===============================================================================</span>
1411 <a name="_sub8" href="#_subfunctions" class="code">function str = entity(str)</a>
1412     <span class="comment">%- Escape HTML special characters</span>
1413     <span class="comment">%- See http://www.w3.org/TR/html4/charset.html#h-5.3.2</span>
1414     
1415     str = strrep(str,<span class="string">'&amp;'</span>,<span class="string">'&amp;amp;'</span>);
1416     str = strrep(str,<span class="string">'&lt;'</span>,<span class="string">'&amp;lt;'</span>);
1417     str = strrep(str,<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>);
1418     str = strrep(str,<span class="string">'&quot;'</span>,<span class="string">'&amp;quot;'</span>);
1419     
1420 <span class="comment">%===============================================================================</span>
1421 <a name="_sub9" href="#_subfunctions" class="code">function str = horztab(str,n)</a>
1422     <span class="comment">%- For browsers, the horizontal tab character is the smallest non-zero</span>
1423     <span class="comment">%- number of spaces necessary to line characters up along tab stops that are</span>
1424     <span class="comment">%- every 8 characters: behaviour obtained when n = 0.</span>
1425     
1426     <span class="keyword">if</span> n &gt; 0
1427         str = strrep(str,sprintf(<span class="string">'\t'</span>),blanks(n));
1428     <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 30-Jun-2017 17:16:47 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>