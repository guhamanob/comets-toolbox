<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of writeCometsLayout</title>
  <meta name="keywords" content="writeCometsLayout">
  <meta name="description" content="WRITECOMETSLAYOUT(input,[filedir],[filename],[includeParams],[writeModels]) Create a layout file along with the corresponding model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # CometsToolbox --><!-- menu.html io -->
<h1>writeCometsLayout
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>WRITECOMETSLAYOUT(input,[filedir],[filename],[includeParams],[writeModels]) Create a layout file along with the corresponding model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function writeCometsLayout( input, filedir, filename, includeParams, writeModels) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">WRITECOMETSLAYOUT(input,[filedir],[filename],[includeParams],[writeModels]) Create a layout file along with the corresponding model
files
 Arguments:
     input: a CometsLayout struct
     filedir: directory in which files should be created. Defaults to the current working directory
     includeParams: should a 'parameters' block be included in the start of the file text?
     writeModels: should model files be created for each model in the given CometsLayout?</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../CometsToolbox/external/m2html/@template/char.html" class="code" title="function s = char(tpl)">char</a>	TEMPLATE Convert a template object in a one line description string</li><li><a href="writeCometsModel.html" class="code" title="function f = writeCometsModel( input, filename, cometsParams)">writeCometsModel</a>	WRITECOMETSMODEL create a Comets input file for the given model</li><li><a href="../../CometsToolbox/util/getModelName.html" class="code" title="function res = getModelName( model )">getModelName</a>	GETMODELNAME Parse the given COBRA model to return a name to be used in</li><li><a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>	STRIDX(str, {str}, [true]) Get the indexes of the query string in the given cell array.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../CometsToolbox/core/run/createCometsFiles.html" class="code" title="function [ output_args ] = createCometsFiles(layout, directory, layoutFileName, separateParamsFiles)">createCometsFiles</a>	CREATECOMETSFILES(layout, [directory], [layoutFileName], [separateParamsFiles])</li><li><a href="../../CometsToolbox/sample/old/demo62.html" class="code" title="">demo62</a>	Import from SBML</li><li><a href="../../CometsToolbox/test/testSetInitialPop.html" class="code" title="">testSetInitialPop</a>	TESTSETINITIALPOP Confirm that the setInitialPop function works as</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function mname = getModelFileName(model)</a></li><li><a href="#_sub2" class="code">function mname = getModelFilePath(model)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function writeCometsLayout( input, filedir, filename, includeParams, writeModels)</a>
0002 <span class="comment">%WRITECOMETSLAYOUT(input,[filedir],[filename],[includeParams],[writeModels]) Create a layout file along with the corresponding model</span>
0003 <span class="comment">%files</span>
0004 <span class="comment">% Arguments:</span>
0005 <span class="comment">%     input: a CometsLayout struct</span>
0006 <span class="comment">%     filedir: directory in which files should be created. Defaults to the current working directory</span>
0007 <span class="comment">%     includeParams: should a 'parameters' block be included in the start of the file text?</span>
0008 <span class="comment">%     writeModels: should model files be created for each model in the given CometsLayout?</span>
0009 <span class="keyword">if</span> nargin == 2
0010     filename = <span class="string">'layout.txt'</span>;
0011     <span class="comment">%filedir = 'layout';</span>
0012 <span class="keyword">end</span>
0013 
0014 <span class="keyword">if</span> nargin &lt; 4
0015     includeParams = true; <span class="comment">%should the params block be printed within this file?</span>
0016 <span class="keyword">end</span>
0017 <span class="keyword">if</span> nargin &lt; 5
0018     writeModels = true;
0019 <span class="keyword">end</span>
0020 
0021 <span class="keyword">if</span> isa(input,<span class="string">'string'</span>)
0022     strct=load(input);
0023     layout=strct.(<a href="../../CometsToolbox/external/m2html/@template/char.html" class="code" title="function s = char(tpl)">char</a>(fieldnames(strct)));
0024 <span class="keyword">else</span>
0025     <span class="keyword">if</span> isa(input,<span class="string">'CometsLayout'</span>)
0026         layout=input;
0027     <span class="keyword">else</span>
0028         error([<span class="string">'Invalid argument in writeCometslayout('</span> class(input)<span class="keyword">...</span>
0029             <span class="string">', '</span> class(filename) <span class="string">'): The first argument should '</span><span class="keyword">...</span>
0030             <span class="string">'be a well-structured COMETS layout or the path of a '</span><span class="keyword">...</span>
0031             <span class="string">'.mat file containing one.'</span>]);
0032     <span class="keyword">end</span>
0033 <span class="keyword">end</span>
0034 
0035 <span class="comment">% %deprecated- CometsLayout is now a class in order to enforce this %assert</span>
0036 <span class="comment">% that the input is a well-structured COMETS layout %check for these fields</span>
0037 <span class="comment">% for cf=['models' 'xdim' 'ydim' 'mets' 'media_amt' 'params'</span>
0038 <span class="comment">% 'diffusion_const' 'media_refresh']</span>
0039 <span class="comment">%     if ~isfield(layout,cf)</span>
0040 <span class="comment">%         error(['Invalid argument in writeCometsLayout(' class(input)...</span>
0041 <span class="comment">%             ', ' class(filename) '): The input layout requires the '...</span>
0042 <span class="comment">%             'following fields: [models xdim ydim mets media_amt params</span>
0043 <span class="comment">%             diffusion_const media_refresh]. Identified fields are '</span>
0044 <span class="comment">%             (char(fieldnames(model)))]);</span>
0045 <span class="comment">%     end</span>
0046 <span class="comment">% end</span>
0047 
0048 <span class="comment">%enforce that layout.models and layout.mets are cell arrays, not single</span>
0049 <span class="comment">%objects in order to simplify parsing downstream</span>
0050 <span class="keyword">if</span> isstruct(layout.models)
0051     layout.models = {layout.models};
0052 <span class="keyword">end</span>
0053 <span class="keyword">if</span> ischar(layout.mets)
0054     layout.mets = {layout.mets};
0055 <span class="keyword">end</span>
0056 <span class="keyword">if</span> ~iscell(layout.models)
0057     error([<span class="string">'Error in layout format: models should be of type cell array'</span><span class="keyword">...</span>
0058         <span class="string">'or be a single COBRA model struct.'</span>]);
0059 <span class="keyword">end</span>
0060 <span class="keyword">if</span> ~iscell(layout.mets)
0061     error([<span class="string">'Error in layout format: mets should be of type cell array'</span><span class="keyword">...</span>
0062         <span class="string">'or char.'</span>]);
0063 <span class="keyword">end</span>
0064 
0065 <span class="comment">%sort the metabolites in the layout alphabetically. Some sections of the</span>
0066 <span class="comment">%layout file may refer to media by their position in the sorted list, not</span>
0067 <span class="comment">%their position in the world_media section</span>
0068 layout = sortMetabolites(layout);
0069 
0070 
0071 filename = fullfile(filedir,filename);
0072 fileID=fopen(filename,<span class="string">'w'</span>);
0073 
0074 <span class="comment">% Parameters</span>
0075 <span class="comment">%</span>
0076 <span class="comment">% This block contains parameters initially loaded with the file. A list of</span>
0077 <span class="comment">% these with their accepted values is here. Here’s the structure of the</span>
0078 <span class="comment">% block:</span>
0079 <span class="comment">%</span>
0080 <span class="comment">% parameters</span>
0081 <span class="comment">%   param_1 = value_1</span>
0082 <span class="comment">%   param_2 = value_2</span>
0083 <span class="comment">%   . . .</span>
0084 <span class="comment">%   param_N = value_N</span>
0085 <span class="comment">% //</span>
0086 <span class="comment">%</span>
0087 <span class="comment">% This block is included at the top of the file for now because</span>
0088 <span class="comment">% flowDiffRate and growthDiffRate will only be applied if parameters are</span>
0089 <span class="comment">% loaded before model files.</span>
0090 <span class="keyword">if</span> includeParams
0091     fprintf(fileID,<span class="string">'\tparameters\n'</span>);
0092     
0093     pfields = fieldnames(layout.params);
0094     dontPrint = {<span class="string">'defaultReactionLower'</span>,<span class="string">'defaultReactionUpper'</span>,<span class="string">'defaultDiffConst'</span>,<span class="string">'objectiveStyle'</span>};
0095     logicalFields = {<span class="string">'writeBiomassLog'</span>,<span class="string">'writeFluxLog'</span>,<span class="string">'writeMediaLog'</span>,<span class="string">'writeTotalBiomassLog'</span>,<span class="keyword">...</span>
0096         <span class="string">'useLogNameTimeStamp'</span>,<span class="string">'showCycleTime'</span>,<span class="string">'showCycleCount'</span>,<span class="string">'saveslideshow'</span>,<span class="keyword">...</span>
0097         <span class="string">'slideshowColorRelative'</span>,<span class="string">'simulateActivation'</span>,<span class="string">'randomOrder'</span>,<span class="string">'pauseOnStep'</span>,<span class="string">'allowCellOverlap'</span>,<span class="keyword">...</span>
0098         <span class="string">'toroidalWorld'</span>,<span class="string">'colorRelative'</span>,<span class="string">'slideshowColorRelative'</span>};
0099     <span class="keyword">for</span> i = 1:length(pfields)
0100         p = pfields{i};
0101         <span class="keyword">if</span> ~ismember(p,dontPrint)
0102             c = <a href="../../CometsToolbox/external/m2html/@template/char.html" class="code" title="function s = char(tpl)">char</a>(p);
0103             val = getfield(layout.params,c);
0104             <span class="keyword">if</span> islogical(val) | ismember(c,logicalFields)
0105                 <span class="keyword">if</span> val
0106                     val = <span class="string">'true'</span>;
0107                 <span class="keyword">else</span>
0108                     val = <span class="string">'false'</span>;
0109                 <span class="keyword">end</span>
0110             <span class="keyword">end</span>
0111             <span class="comment">%     if ~ischar(val)</span>
0112             <span class="comment">%         val = char(val);</span>
0113             <span class="comment">%     end</span>
0114             fprintf(fileID,<span class="string">'\t%s = %s\n'</span>,<a href="../../CometsToolbox/external/m2html/@template/char.html" class="code" title="function s = char(tpl)">char</a>(p),num2str(val));
0115         <span class="keyword">end</span>
0116     <span class="keyword">end</span>
0117     fprintf(fileID,<span class="string">'//\n'</span>);
0118 <span class="keyword">end</span>
0119 
0120 
0121 <span class="comment">% The data blocks in this file are mostly nested within each other. The</span>
0122 <span class="comment">% model file block encapsulates the model world and initial population</span>
0123 <span class="comment">% blocks. The rest of the blocks are listed in the model world block.</span>
0124 
0125 
0126 <span class="comment">% 1. Model Names This is a single line block, NOT followed by // on a line</span>
0127 <span class="comment">% below, but at the end of the file. This must be the first line of the</span>
0128 <span class="comment">% layout file. It is followed by the name of at least one FBA model file.</span>
0129 <span class="comment">%</span>
0130 <span class="comment">% model_file model_file_name1 model_file_name2 ... model_file_name_N 2.</span>
0131 fprintf(fileID,<span class="string">'model_file'</span>);
0132 <span class="keyword">for</span> i = 1:length(layout.models)
0133     m = layout.models{i};
0134     fprintf(fileID,<span class="string">' %s'</span>,<a href="#_sub1" class="code" title="subfunction mname = getModelFileName(model)">getModelFileName</a>(m));
0135 <span class="keyword">end</span>
0136 fprintf(fileID,<span class="string">'\n'</span>);
0137 
0138 <span class="comment">% Model World</span>
0139 <span class="comment">%</span>
0140 <span class="comment">% This is a single line block, NOT followed by // on a line below, but</span>
0141 <span class="comment">% after several internal data blocks. This must be the first block inside</span>
0142 <span class="comment">% the model names block. It simply opens up the data block containing the</span>
0143 <span class="comment">% world information. Optionally, it can be followed by the name of a file</span>
0144 <span class="comment">% containing global media information (note that this is deprecated! Global</span>
0145 <span class="comment">% media information should be included in the layout file under the world</span>
0146 <span class="comment">% media block).</span>
0147 fprintf(fileID,<span class="string">'\tmodel_world\n'</span>);
0148 
0149 <span class="comment">% 2a. Grid Size</span>
0150 <span class="comment">%</span>
0151 <span class="comment">% This is required to be the first block under the model world line. It</span>
0152 <span class="comment">% doesn’t have a closing //, and only describes the width and height of the</span>
0153 <span class="comment">% simulation grid.</span>
0154 <span class="comment">%</span>
0155 <span class="comment">% grid_size  width  height</span>
0156 fprintf(fileID,<span class="string">'\t\tgrid_size %d %d\n'</span>,layout.xdim, layout.ydim);
0157 
0158 <span class="comment">% 2b. World Media</span>
0159 <span class="comment">%</span>
0160 <span class="comment">% The world media block contains global information of the quantity of all</span>
0161 <span class="comment">% extracellular metabolites in the simulation. Each row in the block has</span>
0162 <span class="comment">% two elements – the name of an extracellular metabolite (must be exactly</span>
0163 <span class="comment">% as found in the model file) followed by the quantity of that metabolite</span>
0164 <span class="comment">% initialized in every block in the simulation.</span>
0165 <span class="comment">%</span>
0166 <span class="comment">% This block must come before the media refresh, static media, and</span>
0167 <span class="comment">% diffusion constants blocks.</span>
0168 <span class="comment">%</span>
0169 <span class="comment">% world_media</span>
0170 <span class="comment">%   metab_1  quantity_1 metab_2  quantity_2 metab_3  quantity_3 . . .</span>
0171 <span class="comment">%   metab_N  quantity_N</span>
0172 <span class="comment">% //</span>
0173 fprintf(fileID,<span class="string">'\t\tworld_media\n'</span>);
0174 <span class="keyword">for</span> i = 1:length(layout.mets)
0175     m = layout.mets{i};
0176     idx = layout.metIdx(m);
0177     m = strrep(m,<span class="string">' '</span>,<span class="string">'_'</span>);
0178     fprintf(fileID,<span class="string">'\t\t%s %g\n'</span>,<a href="../../CometsToolbox/external/m2html/@template/char.html" class="code" title="function s = char(tpl)">char</a>(m),layout.media_amt(idx));
0179 <span class="keyword">end</span>
0180 fprintf(fileID,<span class="string">'\t//\n'</span>);
0181 <span class="comment">% 2c. Diffusion Constants</span>
0182 <span class="comment">%</span>
0183 <span class="comment">% The diffusion constants block contains diffusion constant information for</span>
0184 <span class="comment">% the extracellular metabolites in the simulation. The block begins with a</span>
0185 <span class="comment">% global default value on the same line as the opening tag. Each row in the</span>
0186 <span class="comment">% block, then, has two elements – the index of the metabolite in question,</span>
0187 <span class="comment">% in the same order as in the world_media block above (starting from 0);</span>
0188 <span class="comment">% and a value for the diffusion constant if it differs from the default.</span>
0189 <span class="comment">%</span>
0190 <span class="comment">% diffusion_constants    default_value</span>
0191 <span class="comment">%   index_1  diff_const_1 index_2  diff_const_2 index_3  diff_const_3 . . .</span>
0192 ddiff = layout.params.defaultDiffConst;
0193 fprintf(fileID,<span class="string">'\tdiffusion_constants %d\n'</span>,ddiff);
0194 <span class="keyword">if</span> any(layout.diffusion_constants(:,1))
0195     <span class="keyword">for</span> i = 1:length(layout.mets)
0196         m = layout.mets{i};
0197         idx = layout.metIdx(m);
0198         <span class="keyword">if</span> idx &amp;&amp; layout.diffusion_constants(idx,1) <span class="comment">%if the diffusion constant is set</span>
0199             dc = layout.diffusion_constants(idx,2);
0200             <span class="keyword">if</span> dc ~= ddiff <span class="comment">%and the diffusion constant is not equal to the default</span>
0201                 fprintf(fileID,<span class="string">'\t\t%d %g\n'</span>,idx-1,dc);
0202             <span class="keyword">end</span>
0203         <span class="keyword">end</span>
0204     <span class="keyword">end</span>
0205 <span class="keyword">end</span>
0206 fprintf(fileID,<span class="string">'\t//\n'</span>);
0207 
0208 <span class="comment">% // Media</span>
0209 <span class="comment">% TODO: This section should handle specification of media on a cell-by-cell</span>
0210 <span class="comment">% basis.</span>
0211 fprintf(fileID,<span class="string">'\tmedia\n'</span>);
0212 
0213 ms = size(layout.initial_media);
0214 <span class="comment">%s = [# metabolites in media, x, y]</span>
0215 
0216 <span class="keyword">if</span> length(ms) &lt; 3 <span class="comment">%don't break the loop if static_media is empty or 1x1</span>
0217     ms(3) = 1;
0218 <span class="keyword">end</span>
0219 
0220 <span class="keyword">for</span> x = 1:ms(2) <span class="comment">%for each x coordinate</span>
0221     <span class="keyword">for</span> y = 1:ms(3) <span class="comment">%and each y coordinate</span>
0222         v = layout.initial_media(:,x,y,1);<span class="comment">%is it set?</span>
0223         <span class="keyword">if</span> length(v) &lt; length(layout.mets)<span class="comment">%must include a value for all media</span>
0224             v(length(layout.mets)) = 0;
0225         <span class="keyword">end</span>
0226         <span class="keyword">if</span> any(v)
0227             fprintf(fileID,<span class="string">'\t\t%d %d'</span>,x-1,y-1);
0228             <span class="keyword">for</span> j = 1:length(v)
0229                 <span class="keyword">if</span> v(j) <span class="comment">%this medium is set</span>
0230                     fprintf(fileID,<span class="string">' %d'</span>, layout.initial_media(j,x,y,2));
0231                 <span class="keyword">else</span> <span class="comment">%use the global value</span>
0232                     fprintf(fileID,<span class="string">' %d'</span>, layout.media_amt(j));
0233                 <span class="keyword">end</span>
0234             <span class="keyword">end</span>
0235             fprintf(fileID,<span class="string">'\n'</span>);
0236         <span class="keyword">end</span>
0237     <span class="keyword">end</span>
0238 <span class="keyword">end</span>
0239 fprintf(fileID,<span class="string">'\t//\n'</span>);
0240 
0241 <span class="comment">% // 2d. Media Refresh</span>
0242 <span class="comment">%</span>
0243 <span class="comment">% This block describes how much each medium component should be refreshed</span>
0244 <span class="comment">% on each simulation cycle in any given grid space. The opening line</span>
0245 <span class="comment">% contains global refresh values for each medium component, in the same</span>
0246 <span class="comment">% order as presented in the world media block.</span>
0247 <span class="comment">%</span>
0248 <span class="comment">% Each proceeding row contains the amount of media to refresh for each grid</span>
0249 <span class="comment">% space where there is a nonzero refresh value. That is, the only rows that</span>
0250 <span class="comment">% should be present in this block should contain some amount of medium to</span>
0251 <span class="comment">% be refreshed.</span>
0252 <span class="comment">%</span>
0253 <span class="comment">% media_refresh  global_amt_1  global_amt_2  ...  global_amt_N</span>
0254 <span class="comment">%   row_1  col_1  amt_1  amt_2  amt_3  ...  amt_N row_2  col_2  amt_1 amt_2</span>
0255 <span class="comment">%   amt_3  ...  amt_N row_3  col_3  amt_1  amt_2  amt_3  ...  amt_N . . .</span>
0256 <span class="comment">%   row_M  col_M  amt_1  amt_2  amt_3  ...  amt_N</span>
0257 fprintf(fileID,<span class="string">'\tmedia_refresh'</span>);
0258 fprintf(fileID,<span class="string">' %d'</span>,layout.global_media_refresh);
0259 fprintf(fileID,<span class="string">'\n'</span>);
0260 
0261 [mdim,xdim,ydim] = size(layout.media_refresh);
0262 <span class="keyword">for</span> x = 1:xdim
0263     <span class="keyword">for</span> y = 1:ydim
0264         row = layout.media_refresh(1:mdim,x,y);
0265         <span class="keyword">if</span> any(row)
0266             <span class="comment">%fprintf(fileID,'\t\t%d %d %g\n',x-1,y-1,row);</span>
0267             fprintf(fileID,<span class="string">'\t\t%d %d '</span>,x-1,y-1);
0268             <span class="keyword">for</span> i = 1:length(row)
0269                 fprintf(fileID,<span class="string">'%d '</span>,row(i));
0270             <span class="keyword">end</span>
0271             fprintf(fileID,<span class="string">'\n'</span>);
0272         <span class="keyword">end</span>
0273     <span class="keyword">end</span>
0274 <span class="keyword">end</span>
0275 fprintf(fileID,<span class="string">'\t//\n'</span>);
0276 
0277 <span class="comment">% // 2e. Static Media</span>
0278 <span class="comment">%</span>
0279 <span class="comment">% Like the media refresh block, this describes how the media in each space</span>
0280 <span class="comment">% in the grid should be altered during the simulation. However, this block</span>
0281 <span class="comment">% describes which media components should remain at a static value. That</span>
0282 <span class="comment">% is, those media whose quantities should not change due to the effects of</span>
0283 <span class="comment">% the simulation. This might represent a constant sink or source of a</span>
0284 <span class="comment">% number of metabolites.</span>
0285 <span class="comment">%</span>
0286 <span class="comment">% This block contains pairs of data elements. Each pair starts with a</span>
0287 <span class="comment">% binary (0 or 1) element, denoting whether or not to use that pair as a</span>
0288 <span class="comment">% static element, and a quantity to keep that element static at. This lets</span>
0289 <span class="comment">% one build a static media set where only a few medium elements are</span>
0290 <span class="comment">% maintained as static, while keeping the file structure similar to the</span>
0291 <span class="comment">% media refresh block above.</span>
0292 <span class="comment">%</span>
0293 <span class="comment">% For example:</span>
0294 <span class="comment">%</span>
0295 <span class="comment">% static_media  0  0  1  0  1  2  0  0 // Breaks into 4 pairs [0 0], [1 0],</span>
0296 <span class="comment">% [1 2], [0 0]. Only components 2 and 3 have a 1 as their first element, so</span>
0297 <span class="comment">% those medium components are kept static. Component 2 remains at 0, while</span>
0298 <span class="comment">% component 3 stays at 2. Note that in this example, there are no</span>
0299 <span class="comment">% exceptions, so this applies throughout the simulation. In general, it is</span>
0300 <span class="comment">% done like this:</span>
0301 <span class="comment">%</span>
0302 <span class="comment">% static_media  use_1  amt_1  use_2  amt_2  use_3  amt_3  ...  use_N  amt_N</span>
0303 <span class="comment">%   row_1  col_1  use_1  amt_1  use_2  amt_2  ...  use_N  amt_N row_2 col_2</span>
0304 <span class="comment">%   use_1  amt_1  use_2  amt_2  ...  use_N  amt_N row_3  col_3 use_1  amt_1</span>
0305 <span class="comment">%   use_2  amt_2  ...  use_N  amt_N . . . row_M  col_M  use_1 amt_1  use_2</span>
0306 <span class="comment">%   amt_2  ...  use_N  amt_N</span>
0307 fprintf(fileID,<span class="string">'\tstatic_media'</span>);
0308 gs = size(layout.global_static_media);
0309 <span class="keyword">for</span> row = 1:gs(1)
0310     fprintf(fileID,<span class="string">' %g'</span>,layout.global_static_media(row,:));
0311 <span class="keyword">end</span>
0312 fprintf(fileID,<span class="string">'\n'</span>);
0313 
0314 s = size(layout.static_media);
0315 
0316 <span class="keyword">if</span> length(s) &lt; 3 <span class="comment">%don't break the loop if static_media is empty or 1x1</span>
0317     s(3) = 1;
0318 <span class="keyword">end</span>
0319 
0320 <span class="keyword">if</span> any(find(layout.static_media(:,:,:,1)))
0321     <span class="keyword">for</span> x = 1:s(2)
0322         <span class="keyword">for</span> y = 1:s(3)
0323             b = layout.static_media(:,x,y,1);<span class="comment">%is this medium static?</span>
0324             v = layout.static_media(:,x,y,2);<span class="comment">%values</span>
0325             i = find(b); <span class="comment">%indexes</span>
0326             <span class="keyword">if</span> any(i)
0327                 <span class="comment">%            b = zeros(1,gs(1));</span>
0328                 <span class="comment">%            b(i) = 1; %is this medium static?</span>
0329                 sm = [b';v'];
0330                 row = sm(1:(2*gs(1)));<span class="comment">%pairs of logical/value for each media</span>
0331                 fprintf(fileID,<span class="string">'\t\t%d %d'</span>,x-1,y-1);
0332                 <span class="keyword">for</span> j = 1:length(row)
0333                     fprintf(fileID,<span class="string">' %d'</span>,row(j));
0334                 <span class="keyword">end</span>
0335                 fprintf(fileID,<span class="string">'\n'</span>);
0336             <span class="keyword">end</span>
0337         <span class="keyword">end</span>
0338     <span class="keyword">end</span>
0339 <span class="keyword">end</span>
0340 fprintf(fileID,<span class="string">'\t//\n'</span>);
0341 
0342 <span class="comment">% // 2f. Barrier Coordinates</span>
0343 <span class="comment">%</span>
0344 <span class="comment">% Simple enough, this block describes those grid coordinates that contain</span>
0345 <span class="comment">% barriers (i.e., no media, biomass, or diffusion can occur here).</span>
0346 <span class="comment">%</span>
0347 <span class="comment">% barrier</span>
0348 <span class="comment">%   row_1  col_1 row_2  col_2 row_3  col_3 . . . row_N  col_N</span>
0349 fprintf(fileID,<span class="string">'\tbarrier\n'</span>);
0350 s = size(layout.barrier);
0351 <span class="keyword">for</span> x = 1:s(1)
0352     <span class="keyword">for</span> y = 1:s(2)
0353         <span class="keyword">if</span> layout.barrier(x,y)
0354             fprintf(fileID,<span class="string">'\t\t%d %d\n'</span>,x-1,y-1);
0355         <span class="keyword">end</span>
0356     <span class="keyword">end</span>
0357 <span class="keyword">end</span>
0358 
0359 fprintf(fileID,<span class="string">'\t//\n//\n'</span>);
0360 <span class="comment">% // 3. Initial Biomass Population</span>
0361 <span class="comment">%</span>
0362 <span class="comment">% This final block describes the initial biomass population in the layout,</span>
0363 <span class="comment">% and has many options.</span>
0364 <span class="comment">%</span>
0365 <span class="comment">% In the default biomass layout style, there is just initial_pop left alone</span>
0366 <span class="comment">% as the header, followed by one row for each grid space containing</span>
0367 <span class="comment">% biomass. There must be one quantity for each metabolic model in the</span>
0368 <span class="comment">% system.</span>
0369 <span class="comment">%</span>
0370 <span class="comment">% initial_pop</span>
0371 <span class="comment">%   row_1  col_1  biomass_1  biomass_2  ...  biomass_N row_2  col_2</span>
0372 <span class="comment">%   biomass_1  biomass_2  ...  biomass_N row_3  col_3  biomass_1  biomass_2</span>
0373 <span class="comment">%   ...  biomass_N . . . row_M  col_M  biomass_1  biomass_2  ...  biomass_N</span>
0374 <span class="comment">% // The next set of options modify the initial_pop line itself, and</span>
0375 <span class="comment">% contain no rows in the block, though the // on the line below must be</span>
0376 <span class="comment">% present.</span>
0377 <span class="comment">% NOTE: all coordinates here are 0-indexed!</span>
0378 <span class="comment">%</span>
0379 <span class="comment">% initial_pop  random  N1  biomass_1  N2  biomass_2 ... // This will</span>
0380 <span class="comment">% randomly assign Ni spaces to have biomass_i amount of biomass from model</span>
0381 <span class="comment">% i. If biomass from different species is allowed to overlap, then that is</span>
0382 <span class="comment">% allowed to happen in this case, but if different species is not allowed</span>
0383 <span class="comment">% to overlap, then that rule is upheld.</span>
0384 <span class="comment">%</span>
0385 <span class="comment">% initial_pop  random_rect  X  Y  W  H  N1  biomass_1  N2  biomass_2 ... //</span>
0386 <span class="comment">% As above, but the randomly assigned biomass spots are confined to a</span>
0387 <span class="comment">% rectangle with its upper-left corner at grid space (X,Y), with W grid</span>
0388 <span class="comment">% spaces wide, and H spaces tall.</span>
0389 <span class="comment">%</span>
0390 <span class="comment">% initial_pop  filled  biomass_1  biomass_2 ... // This will completely</span>
0391 <span class="comment">% fill the grid with the given amount of biomass from each species.</span>
0392 <span class="comment">%</span>
0393 <span class="comment">% initial_pop  filled_rect  X  Y  W  H  biomass_1  biomass_2 ... // This</span>
0394 <span class="comment">% will completely fill the rectangle (see above) with biomass from each</span>
0395 <span class="comment">% species.</span>
0396 <span class="comment">%</span>
0397 <span class="comment">% initial_pop  square  N1  biomass_1  N2  biomass_2 ... // This will fill</span>
0398 <span class="comment">% squares with radius Ni at the center of the grid with biomass_i from</span>
0399 <span class="comment">% species i.</span>
0400 <span class="keyword">if</span> sum(sum(any(layout.initial_pop))) &gt; 0 <span class="comment">%some initial pop is set</span>
0401     fprintf(fileID,<span class="string">'initial_pop\n'</span>);
0402     s = size(layout.initial_pop);
0403     <span class="keyword">if</span> length(s) &lt; 3 <span class="comment">%don't break the loop if initial_pop is empty or 1x1</span>
0404         s(3) = 1;
0405     <span class="keyword">end</span>
0406     <span class="keyword">for</span> x = 1:s(2)
0407         <span class="keyword">for</span> y = 1:s(3)
0408             v = layout.initial_pop(:,x,y);
0409             <span class="keyword">if</span> any(v)
0410                 <span class="comment">%x y pop1 pop2 pop3...</span>
0411                 fprintf(fileID,[<span class="string">'\t%d %d'</span> sprintf(<span class="string">' %d'</span>,v) <span class="string">'\n'</span>],x-1,y-1);
0412             <span class="keyword">end</span>
0413         <span class="keyword">end</span>
0414     <span class="keyword">end</span>
0415     fprintf(fileID,<span class="string">'//\n'</span>);
0416 <span class="keyword">else</span> <span class="comment">%no initial pop is set</span>
0417 <span class="comment">%     fprintf(fileID,'initial_pop filled');</span>
0418 <span class="comment">%     for i=1:length(layout.models)</span>
0419 <span class="comment">%         fprintf(fileID,' 1E-7');</span>
0420 <span class="comment">%     end</span>
0421     fprintf(fileID,<span class="string">'initial_pop'</span>);
0422     fprintf(fileID,<span class="string">'\n'</span>);
0423     fprintf(fileID,<span class="string">'//\n'</span>);
0424 <span class="keyword">end</span>
0425 
0426 <span class="comment">%if external reactions are set, print the relevent block</span>
0427 <span class="keyword">if</span> ~isempty(layout.external_rxn_mets)
0428     fprintf(fileID,<span class="string">'reactions\n'</span>);
0429     fprintf(fileID,<span class="string">'\treactants\n'</span>);
0430     mets = layout.external_rxn_mets;
0431     rxns = layout.external_rxns;
0432     metdims = size(mets);
0433     nrows = metdims(1);
0434     reactionnames = rxns.name;
0435     <span class="keyword">for</span> i = 1:nrows
0436         row = mets(i,:);
0437         <span class="keyword">if</span> row.stoich &lt; 0 <span class="comment">%only write reactants here</span>
0438             metidx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(row.met{1},layout.mets,false);
0439             rxnidx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(row.rxn{1},reactionnames,false);
0440             rxnrow = rxns(rxnidx,:);
0441             <span class="keyword">if</span> isempty(rxnrow.enzyme{1}) <span class="comment">%no enzyme</span>
0442                 sto = -row.stoich;
0443                 k = rxnrow.k;
0444                 fprintf(fileID,<span class="string">'\t\t%d %d %d %d\n'</span>, rxnidx, metidx, sto, k);
0445             <span class="keyword">else</span> <span class="comment">%enzyme catalyzed</span>
0446                 km = rxnrow.km;
0447                 fprintf(fileID,<span class="string">'\t\t%d %d %d\n'</span>, rxnidx, metidx, km);
0448             <span class="keyword">end</span>
0449         <span class="keyword">end</span>
0450     <span class="keyword">end</span>
0451     fprintf(fileID,<span class="string">'\tenzymes\n'</span>);
0452     rxndims = size(rxns);
0453     nrows = rxndims(1);
0454     <span class="keyword">for</span> i = 1:nrows
0455         row = rxns(i,:);
0456         <span class="keyword">if</span> ~isempty(row.enzyme{1})
0457             enzidx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(row.enzyme{1},layout.mets,false);
0458             fprintf(fileID,<span class="string">'\t\t%d %d %d\n'</span>, i, enzidx, row.k);
0459         <span class="keyword">end</span>
0460     <span class="keyword">end</span>
0461     fprintf(fileID,<span class="string">'\tproducts\n'</span>);
0462     nrows = metdims(1);
0463     <span class="keyword">for</span> i = 1:nrows
0464         row = mets(i,:);
0465         rxnidx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(row.rxn{1},reactionnames,false);
0466         <span class="keyword">if</span> row.stoich &gt; 0
0467             metidx = <a href="../../CometsToolbox/util/stridx.html" class="code" title="function [idx] = stridx(query, list, allowSubstr)">stridx</a>(row.met{1},layout.mets,false);
0468             sto = row.stoich;
0469             fprintf(fileID,<span class="string">'\t\t%d %d %d\n'</span>, rxnidx, metidx, sto);
0470         <span class="keyword">end</span>
0471     <span class="keyword">end</span>
0472     fprintf(fileID,<span class="string">'//\n'</span>);
0473 <span class="keyword">end</span>
0474 
0475 fclose(fileID);
0476 
0477 <span class="comment">%write the model files</span>
0478 <span class="keyword">if</span> writeModels
0479     <span class="keyword">for</span> i = 1:length(layout.models)
0480         m = layout.models{i};
0481         <a href="writeCometsModel.html" class="code" title="function f = writeCometsModel( input, filename, cometsParams)">writeCometsModel</a>(m,<a href="#_sub2" class="code" title="subfunction mname = getModelFilePath(model)">getModelFilePath</a>(m),layout.params);
0482     <span class="keyword">end</span>
0483 <span class="keyword">end</span>
0484 
0485     <a name="_sub1" href="#_subfunctions" class="code">function mname = getModelFileName(model)</a>
0486         name = <a href="../../CometsToolbox/util/getModelName.html" class="code" title="function res = getModelName( model )">getModelName</a>(model);
0487         mname = [name <span class="string">'.txt'</span>]; <span class="comment">%relative path; file goes in current directory</span>
0488     <span class="keyword">end</span>
0489     <a name="_sub2" href="#_subfunctions" class="code">function mname = getModelFilePath(model)</a>
0490         fname = <a href="#_sub1" class="code" title="subfunction mname = getModelFileName(model)">getModelFileName</a>(model);
0491         mname = fullfile(filedir,fname); <span class="comment">%absolute path</span>
0492     <span class="keyword">end</span>
0493 
0494 <span class="keyword">end</span>
0495</pre></div>
<hr><address>Generated on Thu 14-Jun-2018 15:27:34 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>